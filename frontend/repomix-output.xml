This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.env.example
.gitignore
index.html
package.json
postcss.config.js
public/favicon.svg
public/hotspot-logo.png
public/icons/bank.svg
public/icons/bar.svg
public/icons/book.svg
public/icons/building.svg
public/icons/bus.svg
public/icons/cafe.svg
public/icons/clothing.svg
public/icons/college.svg
public/icons/electronics.svg
public/icons/gym.svg
public/icons/hospital.svg
public/icons/house.svg
public/icons/location-pin.svg
public/icons/mall.svg
public/icons/marker.svg
public/icons/metro.svg
public/icons/office.svg
public/icons/park.svg
public/icons/pharmacy.svg
public/icons/restaurant.svg
public/icons/salon.svg
public/icons/school.svg
public/icons/search.svg
public/icons/star.svg
public/icons/store.svg
public/icons/temple.svg
public/logo.svg
src/App.jsx
src/components/Chat/ChatBot.jsx
src/components/Chat/index.js
src/components/common/Icon.jsx
src/components/common/index.js
src/components/Dashboard/AnalysisPanel.jsx
src/components/Dashboard/Charts/CompetitorChart.jsx
src/components/Dashboard/Charts/index.js
src/components/Dashboard/Charts/LandmarkRadar.jsx
src/components/Dashboard/Charts/ScoreGauge.jsx
src/components/Dashboard/CompetitorCard.jsx
src/components/Dashboard/index.js
src/components/Dashboard/LandmarksCard.jsx
src/components/Dashboard/LoadingProgress.jsx
src/components/Dashboard/MetricsGrid.jsx
src/components/Dashboard/RecommendedSpotsCard.jsx
src/components/Dashboard/ScoreCard.jsx
src/components/Filters/BusinessTypeSelector.jsx
src/components/Filters/index.js
src/components/Filters/ProximityFilters.jsx
src/components/Layout/Header.jsx
src/components/Layout/index.js
src/components/Map/HeatmapOverlay.jsx
src/components/Map/index.js
src/components/Map/MapView.jsx
src/components/Search/index.js
src/components/Search/SearchBar.jsx
src/hooks/index.js
src/hooks/useAnalysis.js
src/hooks/useFilters.js
src/hooks/useLocation.js
src/index.css
src/main.jsx
src/services/api.js
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".env.example">
# Frontend Environment Variables
VITE_API_BASE_URL=http://localhost:5000/api
</file>

<file path=".gitignore">
# Dependencies
node_modules/

# Build output
dist/
build/

# Environment
.env
.env.local
.env.*.local

# IDE
.idea/
.vscode/
*.swp
*.swo

# OS
.DS_Store
Thumbs.db

# Logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Cache
.cache/
.eslintcache
</file>

<file path="index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hotspot IQ - Location Intelligence</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  </head>
  <body class="bg-canvas-deep text-slate-50 font-sans">
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "hotspot-iq-frontend",
  "private": true,
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext js,jsx --report-unused-disable-directives --max-warnings 0"
  },
  "dependencies": {
    "axios": "^1.6.2",
    "leaflet": "^1.9.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-leaflet": "^4.2.1",
    "recharts": "^2.10.3"
  },
  "devDependencies": {
    "@types/react": "^18.2.43",
    "@types/react-dom": "^18.2.17",
    "@vitejs/plugin-react": "^4.2.1",
    "autoprefixer": "^10.4.16",
    "eslint": "^8.55.0",
    "eslint-plugin-react": "^7.33.2",
    "eslint-plugin-react-hooks": "^4.6.0",
    "eslint-plugin-react-refresh": "^0.4.5",
    "postcss": "^8.4.32",
    "tailwindcss": "^3.3.6",
    "vite": "^5.0.8"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="public/favicon.svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32">
  <defs>
    <linearGradient id="heatGrad" x1="0%" y1="100%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F7B731"/>
      <stop offset="100%" style="stop-color:#EB5B3C"/>
    </linearGradient>
    <linearGradient id="pinGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1E3A5F"/>
      <stop offset="100%" style="stop-color:#0F2439"/>
    </linearGradient>
  </defs>
  
  <!-- Heatmap base -->
  <ellipse cx="16" cy="25" rx="14" ry="5" fill="#F7B731" opacity="0.9"/>
  <ellipse cx="16" cy="24" rx="10" ry="4" fill="#F5A623"/>
  <ellipse cx="16" cy="23" rx="6" ry="2.5" fill="#EB5B3C"/>
  
  <!-- Pin -->
  <path d="M16 3 C10.5 3 6 7.5 6 13 C6 18.5 16 26 16 26 C16 26 26 18.5 26 13 C26 7.5 21.5 3 16 3 Z" 
        fill="url(#pinGrad)"/>
  
  <!-- Inner circles -->
  <circle cx="16" cy="12" r="5" fill="white"/>
  <circle cx="16" cy="12" r="2.5" fill="#F5A623"/>
</svg>
</file>

<file path="public/icons/bank.svg">
<!-- Bank/ATM icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4L4 16v4h56v-4L32 4zM8 24v28h8V24H8zm16 0v28h8V24h-8zm16 0v28h8V24h-8zm16 0v28h8V24h-8zM4 56v4h56v-4H4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/bar.svg">
<!-- Bar/Drink icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M8 8v8l20 24v16H16v4h32v-4H36V40l20-24V8H8zm8 4h32l-16 20L16 12z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/book.svg">
<!-- Book icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M12 8v48c0 2.2 1.8 4 4 4h36V8H16c-2.2 0-4 1.8-4 4zm8 4h28v40H20V12zm4 8v4h20v-4H24zm0 8v4h20v-4H24z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/building.svg">
<!-- Building/Other icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M8 4v56h20V48h8v12h20V4H8zm8 8h8v8h-8v-8zm16 0h8v8h-8v-8zm16 0h8v8h-8v-8zM16 28h8v8h-8v-8zm16 0h8v8h-8v-8zm16 0h8v8h-8v-8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/bus.svg">
<!-- Bus icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M12 8c-2.2 0-4 1.8-4 4v36c0 2.2 1.8 4 4 4h4v4h8v-4h16v4h8v-4h4c2.2 0 4-1.8 4-4V12c0-2.2-1.8-4-4-4H12zm4 8h32v16H16V16zm0 24c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm32 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/cafe.svg">
<!-- Cafe icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M48 16H12c-2.2 0-4 1.8-4 4v8c0 8.8 7.2 16 16 16h8c8.8 0 16-7.2 16-16v-4h4c2.2 0 4-1.8 4-4s-1.8-4-4-4h-4zm0 8h4v-4h-4v4zM8 52h48v4H8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/clothing.svg">
<!-- Clothing icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M24 4l-16 12v12l8-4v36h32V24l8 4V16L40 4h-4c0 4.4-3.6 8-8 8s-8-3.6-8-8h-4v8c0 2.2 1.8 4 4 4h8c2.2 0 4-1.8 4-4V4h-8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/college.svg">
<!-- College/University icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4L4 18l28 14 28-14L32 4zM8 24v4l24 12 24-12v-4L32 36 8 24zm4 12v16l20 8 20-8V36l-20 10-20-10z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/electronics.svg">
<!-- Electronics icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M16 4c-2.2 0-4 1.8-4 4v40c0 2.2 1.8 4 4 4h4v4c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4v-4h4c2.2 0 4-1.8 4-4V8c0-2.2-1.8-4-4-4H16zm4 8h24v28H20V12zm12 32c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/gym.svg">
<!-- Gym/Fitness icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M4 24v16h4v-4h4v4h4V24h-4v4H8v-4H4zm48 0v16h4v-4h4v4h4V24h-4v4h-4v-4h-4zM16 28v8h32v-8H16z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/hospital.svg">
<!-- Hospital icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M8 8v48h48V8H8zm20 8h8v12h12v8H36v12h-8V36H16v-8h12V16z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/house.svg">
<!-- House/Residential icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4L4 32h8v24h16V40h8v16h16V32h8L32 4zm0 12l12 12v20H36V32h-8v16H20V28l12-12z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/location-pin.svg">
<!-- Location pin icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <defs>
    <linearGradient id="pinGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1E3A5F"/>
      <stop offset="100%" style="stop-color:#0F2439"/>
    </linearGradient>
  </defs>
  <path d="M32 4C20 4 10 14 10 26c0 16 22 34 22 34s22-18 22-34c0-12-10-22-22-22z" fill="url(#pinGrad)"/>
  <circle cx="32" cy="24" r="10" fill="white"/>
  <circle cx="32" cy="24" r="5" fill="#F5A623"/>
</svg>
</file>

<file path="public/icons/mall.svg">
<!-- Mall/Shopping icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M20 8l-4 16H8v4h48v-4h-8l-4-16H20zm-4 24v24h8V40h16v16h8V32H16zm8-20h16l2 8H22l2-8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/marker.svg">
<!-- Competitor/Store marker icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4C20 4 10 14 10 26c0 16 22 34 22 34s22-18 22-34c0-12-10-22-22-22zm0 30c-4.4 0-8-3.6-8-8s3.6-8 8-8 8 3.6 8 8-3.6 8-8 8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/metro.svg">
<!-- Metro/Train icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M16 4c-4.4 0-8 3.6-8 8v32c0 4.4 3.6 8 8 8l-4 8h4l4-8h24l4 8h4l-4-8c4.4 0 8-3.6 8-8V12c0-4.4-3.6-8-8-8H16zm0 8h32v16H16V12zm4 24c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4zm24 0c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/office.svg">
<!-- Office/Building icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M12 4v56h16V48h8v12h16V4H12zm8 8h8v8h-8v-8zm16 0h8v8h-8v-8zm-16 16h8v8h-8v-8zm16 0h8v8h-8v-8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/park.svg">
<!-- Park/Tree icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4c-8 0-16 8-16 20h-4l12 16h-6l14 20h4V44h-6l12-16h-4C44 12 40 4 32 4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/pharmacy.svg">
<!-- Pharmacy/Medical icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M24 4v16H8v24h16v16h16V44h16V20H40V4H24zm4 20h8v8h8v8h-8v8h-8v-8h-8v-8h8v-8z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/restaurant.svg">
<!-- Restaurant icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M20 4c-1.1 0-2 .9-2 2v20c0 3.3 2.7 6 6 6v26c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2V32c3.3 0 6-2.7 6-6V6c0-1.1-.9-2-2-2s-2 .9-2 2v16h-4V6c0-1.1-.9-2-2-2s-2 .9-2 2v16h-4V6c0-1.1-.9-2-2-2zm24 0c-1.1 0-2 .9-2 2v22c0 2.8 1.6 5.2 4 6.3V58c0 1.1.9 2 2 2h4c1.1 0 2-.9 2-2V6c0-7.7-8-2-10-2z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/salon.svg">
<!-- Salon icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4C20 4 12 16 12 28c0 8 4 15 10 19v9c0 2.2 1.8 4 4 4h12c2.2 0 4-1.8 4-4v-9c6-4 10-11 10-19C52 16 44 4 32 4zm-4 28c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4zm8 0c-2.2 0-4-1.8-4-4s1.8-4 4-4 4 1.8 4 4-1.8 4-4 4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/school.svg">
<!-- School icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4L4 20v4l28-12 28 12v-4L32 4zM8 28v28h16V40h16v16h16V28l-24-10L8 28z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/search.svg">
<!-- Search icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M28 8C16.96 8 8 16.96 8 28s8.96 20 20 20c4.44 0 8.56-1.48 11.9-3.96L51.04 55.2l5.66-5.66-11.14-11.14C48.04 35.06 48 31.58 48 28c0-11.04-8.96-20-20-20zm0 8c6.62 0 12 5.38 12 12s-5.38 12-12 12-12-5.38-12-12 5.38-12 12-12z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/star.svg">
<!-- Star/Recommended icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4l-9.17 18.58L4 25.82l13.42 13.08L14.17 58 32 48.42 49.83 58l-3.25-19.1L60 25.82l-18.83-3.24L32 4z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/store.svg">
<!-- Store/Retail icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M8 8v8l4 8v32h40V24l4-8V8H8zm8 16h8v16h-8V24zm16 0h8v16h-8V24z" fill="currentColor"/>
</svg>
</file>

<file path="public/icons/temple.svg">
<!-- Temple icon - Flaticon style -->
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="64" height="64">
  <path d="M32 4l-4 8h-4l-8 12H8v4h4v28h8V36h24v20h8V28h4v-4h-8l-8-12h-4l-4-8zm0 12c2.2 0 4 1.8 4 4s-1.8 4-4 4-4-1.8-4-4 1.8-4 4-4z" fill="currentColor"/>
</svg>
</file>

<file path="public/logo.svg">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100">
  <!-- Heatmap base (yellow to orange gradient rings) -->
  <defs>
    <linearGradient id="heatGradient" x1="0%" y1="100%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#F7B731;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#F5A623;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EB5B3C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="pinGradient" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#1E3A5F;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0F2439;stop-opacity:1" />
    </linearGradient>
  </defs>
  
  <!-- Heatmap rings (perspective transformed) -->
  <ellipse cx="50" cy="75" rx="45" ry="18" fill="#F7B731" opacity="0.9"/>
  <ellipse cx="50" cy="72" rx="35" ry="14" fill="#F5A623" opacity="0.95"/>
  <ellipse cx="50" cy="69" rx="25" ry="10" fill="#EB5B3C" opacity="1"/>
  <ellipse cx="50" cy="66" rx="15" ry="6" fill="#E74C3C" opacity="1"/>
  
  <!-- Location Pin -->
  <path d="M50 12 C35 12 24 23 24 38 C24 53 50 70 50 70 C50 70 76 53 76 38 C76 23 65 12 50 12 Z" 
        fill="url(#pinGradient)" 
        stroke="#1E3A5F" 
        stroke-width="1"/>
  
  <!-- Inner circle (white) -->
  <circle cx="50" cy="36" r="14" fill="white"/>
  
  <!-- Center dot (orange) -->
  <circle cx="50" cy="36" r="7" fill="#F5A623"/>
</svg>
</file>

<file path="src/App.jsx">
/**
 * App.jsx - Main Application Component
 * Hotspot IQ - Location Intelligence Platform
 */

import { useState, useCallback, useEffect } from 'react';

// Layout
import { Header } from './components/Layout';

// Components
import { BusinessTypeSelector } from './components/Filters';
import { SearchBar } from './components/Search';
import { MapView } from './components/Map';
import { AnalysisPanel, LoadingProgress } from './components/Dashboard';
import { ChatBot } from './components/Chat';

// Hooks
import { useAnalysis } from './hooks';

// API
import { geocodeLocation, reverseGeocode } from './services/api';

// Toast notification component
function Toast({ message, type = 'error', onClose }) {
  useEffect(() => {
    const timer = setTimeout(onClose, 8000); // Auto-close after 8 seconds
    return () => clearTimeout(timer);
  }, [onClose]);

  const bgColor = type === 'error'
    ? 'bg-red-500/95 border-red-400'
    : type === 'warning'
      ? 'bg-amber-500/95 border-amber-400'
      : 'bg-emerald-500/95 border-emerald-400';

  const icon = type === 'error' ? (
    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
    </svg>
  ) : type === 'warning' ? (
    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
    </svg>
  ) : (
    <svg className="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
    </svg>
  );

  return (
    <div className={`fixed top-20 left-1/2 transform -translate-x-1/2 z-50 ${bgColor} text-white px-6 py-4 rounded-xl shadow-2xl border-2 flex items-center gap-4 max-w-lg animate-slide-down`}>
      {icon}
      <div className="flex-1">
        <p className="font-semibold text-sm uppercase tracking-wide opacity-90">
          {type === 'error' ? 'Location Invalid' : type === 'warning' ? 'Warning' : 'Success'}
        </p>
        <p className="text-white/95 mt-1">{message}</p>
      </div>
      <button
        onClick={onClose}
        className="text-white/80 hover:text-white transition-colors p-1"
      >
        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  );
}

export default function App() {
  // Theme state - default to dark mode
  const [isDarkMode, setIsDarkMode] = useState(() => {
    // Check localStorage for saved preference, default to dark
    const saved = localStorage.getItem('hotspotiq-theme');
    return saved ? saved === 'dark' : true;
  });

  // Toggle theme and save preference
  const toggleTheme = useCallback(() => {
    setIsDarkMode(prev => {
      const newMode = !prev;
      localStorage.setItem('hotspotiq-theme', newMode ? 'dark' : 'light');
      return newMode;
    });
  }, []);

  // Apply theme class to document
  useEffect(() => {
    if (isDarkMode) {
      document.documentElement.classList.add('dark');
      document.documentElement.classList.remove('light');
    } else {
      document.documentElement.classList.add('light');
      document.documentElement.classList.remove('dark');
    }
  }, [isDarkMode]);

  // Step 1: Business Type
  const [businessType, setBusinessType] = useState(null);

  // Step 2: Proximity Filters
  const [selectedFilters, setSelectedFilters] = useState([]);
  // Step 2.5: Radius
  const [radius, setRadius] = useState(1000);

  // Step 3: Selected Location
  const [selectedLocation, setSelectedLocation] = useState(null);
  const [isGeocoding, setIsGeocoding] = useState(false);
  // Toast notification state
  const [toast, setToast] = useState(null);
  // Analysis state
  const {
    analysis,
    isochrone,
    isLoading,
    error,
    loadingStatus,
    analyze,
    clearAnalysis
  } = useAnalysis();

  // Panel state
  const [isPanelOpen, setIsPanelOpen] = useState(false);
  // Map display toggles
  const [showLandmarks, setShowLandmarks] = useState(true);
  const [showCompetitors, setShowCompetitors] = useState(true);
  const [isChatOpen, setIsChatOpen] = useState(false);

  // Handle location selection - geocode if needed
  const handleLocationSelect = useCallback(async (location) => {
    // If location already has coordinates, use it directly
    if (location.lat != null && location.lng != null) {
      setSelectedLocation(location);
      return;
    }

    // Otherwise, geocode the location name to get coordinates
    setIsGeocoding(true);
    try {
      const geocoded = await geocodeLocation(location.name);
      if (geocoded && geocoded.lat && geocoded.lng) {
        setSelectedLocation({
          name: location.name,
          lat: geocoded.lat,
          lng: geocoded.lng,
          address: geocoded.address,
          geoid: location.geoid,
          is_major: location.is_major || false,  // Preserve major area flag
          is_area: location.is_area || false,
        });
      } else {
        console.error('Geocoding returned no coordinates');
        // Show an alert or set an error state
        alert('Could not find coordinates for this location. Please try a different search.');
      }
    } catch (error) {
      console.error('Geocode error:', error);
      alert('Could not find coordinates for this location. Please try a different search.');
    } finally {
      setIsGeocoding(false);
    }
  }, []);

  // Handle map click - reverse geocode to get address
  const handleMapClick = useCallback(async (coords) => {
    // Set immediately with coordinates for responsiveness
    const tempName = `${coords.lat.toFixed(4)}, ${coords.lng.toFixed(4)}`;
    setSelectedLocation({
      name: tempName,
      lat: coords.lat,
      lng: coords.lng,
    });

    // Reverse geocode using the selected radius to get area name for the whole region
    try {
      // Use the current radius for area-based reverse geocoding
      const result = await reverseGeocode(coords.lat, coords.lng, radius);
      if (result) {
        // Use area_name for display (cleaner, shows just the locality)
        // Fall back to formatted_address if area_name is not available
        const displayName = result.area_name || result.formatted_address || tempName;
        setSelectedLocation({
          name: displayName,
          lat: coords.lat,
          lng: coords.lng,
          pincode: result.pincode,
          landmark: result.landmark,
          fullAddress: result.formatted_address, // Keep full address for reference
          areasInRadius: result.areas_in_radius, // All areas found in the radius
        });
      }
    } catch (error) {
      console.error('Reverse geocode failed:', error);
      // Keep the coordinate-based name if reverse geocode fails
    }
  }, [radius]);

  // Update area name when radius changes (if we have a selected location)
  useEffect(() => {
    const updateAreaName = async () => {
      if (!selectedLocation?.lat || !selectedLocation?.lng) return;
      
      try {
        const result = await reverseGeocode(selectedLocation.lat, selectedLocation.lng, radius);
        if (result?.area_name) {
          setSelectedLocation(prev => ({
            ...prev,
            name: result.area_name,
            areasInRadius: result.areas_in_radius,
          }));
        }
      } catch (error) {
        console.error('Failed to update area name for new radius:', error);
      }
    };
    
    // Debounce the update to avoid too many API calls while sliding
    const timeoutId = setTimeout(updateAreaName, 500);
    return () => clearTimeout(timeoutId);
  }, [radius, selectedLocation?.lat, selectedLocation?.lng]);

  // Handle analyze button click
  const handleAnalyze = useCallback(async () => {
    if (!selectedLocation || !businessType) return;

    // Ensure we have coordinates
    if (selectedLocation.lat == null || selectedLocation.lng == null) {
      setToast({
        message: 'Location coordinates are missing. Please select a location from the search results.',
        type: 'warning'
      });
      return;
    }

    // Clear any existing toast
    setToast(null);

    // Run analysis (this clears markers internally before fetching)
    const result = await analyze(selectedLocation, businessType, selectedFilters, radius);

    // Handle validation errors
    if (!result.success) {
      if (result.isValidationError) {
        // Show validation error toast - map remains clear
        setToast({
          message: result.errorMessage,
          type: 'error'
        });
        // Don't open the panel on validation error
        return;
      }
      // For other errors, show warning toast
      setToast({
        message: result.errorMessage || 'Analysis failed. Please try again.',
        type: 'warning'
      });
      return;
    }

    // Success - open the panel
    setIsPanelOpen(true);
  }, [selectedLocation, businessType, selectedFilters, analyze, radius]);

  // Handle viewing a recommended spot on the map
  const handleViewSpot = useCallback((spot) => {
    // This will cause the map to pan to the spot location
    // We can show a temporary marker or highlight
    console.log('View spot:', spot);
    // The spot marker is already on the map, just close the panel so user can see it
    setIsPanelOpen(false);
  }, []);

  // Check if ready to analyze - need coordinates
  const canAnalyze = businessType && selectedLocation && selectedLocation.lat != null && selectedLocation.lng != null && !isLoading && !isGeocoding;

  return (
    <div className="h-screen bg-canvas-base overflow-hidden">
      {/* Toast Notification for Validation Errors */}
      {toast && (
        <Toast
          message={toast.message}
          type={toast.type}
          onClose={() => setToast(null)}
        />
      )}

      {/* Floating Header - Above everything */}
      <Header isDarkMode={isDarkMode} onToggleTheme={toggleTheme} />

      {/* Full-screen Map Layer */}
      <div className="absolute inset-0">
        <MapView
          selectedLocation={selectedLocation}
          competitors={analysis?.competitors?.nearby || []}
          landmarks={analysis?.landmarks?.list || []}
          recommendedSpots={analysis?.recommended_spots || []}
          isochrone={isochrone}
          onMapClick={handleMapClick}
          onSpotClick={handleViewSpot}
          showLandmarks={showLandmarks}
          showCompetitors={showCompetitors}
          setShowLandmarks={setShowLandmarks}
          setShowCompetitors={setShowCompetitors}
          businessType={businessType}
          radius={radius}
          analysis={analysis}
          onOpenPanel={() => setIsPanelOpen(true)}
          isLoading={isLoading}
          isDarkMode={isDarkMode}
        />
      </div>

      {/* Loading Progress - Fixed Top Right (above map controls) */}
      {(isLoading || loadingStatus.step === 'complete' || loadingStatus.step === 'error') && (
        <LoadingProgress status={loadingStatus} isLoading={isLoading} />
      )}

      {/* Command Panel - Left Sidebar */}
      <div className="fixed left-6 top-20 bottom-6 w-[340px] z-20 pointer-events-none">
        <div className="h-full backdrop-blur-xl bg-slate-900/80 border border-white/10 rounded-3xl shadow-2xl shadow-black/30 pointer-events-auto overflow-hidden flex flex-col">
          {/* Sidebar Header */}
          <div className="p-5 border-b border-white/5">
            <h2 className="text-lg font-semibold text-white flex items-center gap-2">
              <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
                <svg className="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
              </div>
              Location Analysis
            </h2>
            <p className="text-xs text-slate-500 mt-1">Configure your business search parameters</p>
          </div>

          {/* Scrollable Content */}
          <div className="flex-1 overflow-y-auto p-5 space-y-5">
            {/* Step 1: Location Search - Spotlight Style */}
            <div className="relative z-30">
              <SearchBar
                onLocationSelect={handleLocationSelect}
                disabled={false}
                selectedLocation={selectedLocation}
              />
            </div>

            {/* Step 2: Search Radius Slider */}
            <div className="space-y-3">
              <div className="flex justify-between items-center">
                <label className="text-sm font-medium text-slate-300">Search Radius</label>
                <span className="text-sm font-mono text-emerald-400 bg-emerald-500/10 px-3 py-1 rounded-full border border-emerald-500/20">
                  {radius >= 1000 ? `${(radius / 1000).toFixed(1)} km` : `${radius} m`}
                </span>
              </div>
              <input
                type="range"
                min="500"
                max="5000"
                step="100"
                value={radius}
                onChange={(e) => setRadius(parseInt(e.target.value))}
                className="w-full h-2 bg-slate-700/50 rounded-full appearance-none cursor-pointer accent-emerald-500"
              />
              <div className="flex justify-between text-[10px] text-slate-500">
                <span>0.5 km</span>
                <span>2.5 km</span>
                <span>5.0 km</span>
              </div>
            </div>

            {/* Step 3: Business Type - Icon Grid */}
            <div className="relative z-10">
              <BusinessTypeSelector
                value={businessType}
                onChange={(value) => {
                  setBusinessType(value);
                  clearAnalysis();
                }}
              />
            </div>
          </div>

          {/* Fixed Footer - Analyze Button */}
          <div className="p-5 border-t border-white/5 bg-slate-900/50">
            {selectedLocation ? (
              <button
                onClick={handleAnalyze}
                disabled={!canAnalyze}
                className={`
                  w-full py-4 rounded-xl text-base font-semibold transition-all duration-300
                  flex items-center justify-center gap-2
                  ${canAnalyze 
                    ? 'bg-gradient-to-r from-emerald-500 to-cyan-500 text-white hover:shadow-lg hover:shadow-emerald-500/25 hover:scale-[1.02] active:scale-[0.98]' 
                    : 'bg-slate-800 text-slate-500 cursor-not-allowed'}
                `}
              >
                {isLoading ? (
                  <>
                    <svg className="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                    <span>Analyzing...</span>
                  </>
                ) : isGeocoding ? (
                  <>
                    <svg className="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                    </svg>
                    <span>Finding location...</span>
                  </>
                ) : (
                  <>
                    <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    <span>Analyze Location</span>
                  </>
                )}
              </button>
            ) : (
              <div className="text-center text-sm text-slate-500 py-3">
                <p>Select a business type and location to begin</p>
              </div>
            )}
          </div>
        </div>
      </div>



      {/* Analysis Panel */}
      <AnalysisPanel
        analysis={analysis}
        isLoading={isLoading}
        isOpen={isPanelOpen}
        onClose={() => setIsPanelOpen(false)}
        onViewSpot={handleViewSpot}
        onOpenChat={() => setIsChatOpen(true)}
      />

      {/* Chat Bot */}
      <ChatBot
        selectedLocation={selectedLocation}
        businessType={businessType}
        analysis={analysis}
        isOpen={isChatOpen}
        onClose={() => setIsChatOpen(false)}
      />
    </div>
  );
}
</file>

<file path="src/components/Chat/ChatBot.jsx">
import React, { useState, useRef, useEffect } from 'react';
import { chat } from '../../services/api';

export const ChatBot = ({ selectedLocation, businessType, analysis, isOpen, onClose }) => {
    const [messages, setMessages] = useState([
        {
            role: 'assistant',
            content: 'Hi! I\'m Hotspot IQ. I can help you analyze locations and answer questions about your business expansion. How can I help you today?'
        }
    ]);
    const [input, setInput] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const messagesEndRef = useRef(null);

    const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
    };

    useEffect(() => {
        if (isOpen) {
            scrollToBottom();
        }
    }, [messages, isOpen]);

    const handleSend = async (e) => {
        e.preventDefault();
        if (!input.trim()) return;

        const userMessage = input.trim();
        setInput('');
        setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
        setIsLoading(true);

        try {
            const context = {
                lat: selectedLocation?.lat,
                lng: selectedLocation?.lng,
                business_type: businessType,
                analysis_data: analysis
            };

            const response = await chat(userMessage, context);

            setMessages(prev => [...prev, {
                role: 'assistant',
                content: response.response,
                isAi: response.ai_powered
            }]);
        } catch (error) {
            setMessages(prev => [...prev, {
                role: 'assistant',
                content: 'Sorry, I encountered an error. Please try again later.',
                isError: true
            }]);
        } finally {
            setIsLoading(false);
        }
    };

    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-50 flex items-center justify-center pointer-events-auto">
            {/* Backdrop */}
            <div
                className="absolute inset-0 bg-black/50 backdrop-blur-sm"
                onClick={onClose}
            />

            {/* Chat Window */}
            <div className="relative w-full max-w-lg h-[600px] glass-panel flex flex-col shadow-2xl animate-in zoom-in-95 fade-in duration-200 mx-4">
                {/* Header */}
                <div className="p-4 border-b border-surface-border flex justify-between items-center bg-surface-elevated/50">
                    <div className="flex items-center gap-2">
                        <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse" />
                        <h3 className="font-semibold text-white">Hotspot IQ Assistant</h3>
                    </div>
                    <button
                        onClick={onClose}
                        className="text-slate-400 hover:text-white transition-colors"
                    >
                        <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>

                {/* Messages */}
                <div className="flex-1 overflow-y-auto p-4 space-y-4">
                    {messages.map((msg, idx) => (
                        <div
                            key={idx}
                            className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                        >
                            <div
                                className={`
                max-w-[80%] p-3 rounded-2xl text-sm
                ${msg.role === 'user'
                                        ? 'bg-primary-glow/20 text-white rounded-tr-sm border border-primary-glow/30'
                                        : 'bg-surface-elevated text-slate-200 rounded-tl-sm border border-surface-border'
                                    }
                ${msg.isError ? 'border-destructive-glow/50 text-destructive-glow' : ''}
              `}
                            >
                                <p className="whitespace-pre-wrap">{msg.content}</p>
                                {msg.isAi && (
                                    <div className="mt-1 flex items-center gap-1 opacity-50">
                                        <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                        <span className="text-[10px]">AI Powered</span>
                                    </div>
                                )}
                            </div>
                        </div>
                    ))}
                    {isLoading && (
                        <div className="flex justify-start">
                            <div className="bg-surface-elevated p-3 rounded-2xl rounded-tl-sm border border-surface-border">
                                <div className="flex gap-1">
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                                    <div className="w-2 h-2 bg-slate-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
                                </div>
                            </div>
                        </div>
                    )}
                    <div ref={messagesEndRef} />
                </div>

                {/* Input */}
                <form onSubmit={handleSend} className="p-4 border-t border-surface-border bg-surface-elevated/30">
                    <div className="relative">
                        <input
                            type="text"
                            value={input}
                            onChange={(e) => setInput(e.target.value)}
                            placeholder="Ask about this location..."
                            className="w-full bg-surface-base border border-surface-border rounded-xl py-3 pl-4 pr-12 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-primary-glow focus:ring-1 focus:ring-primary-glow transition-all"
                            disabled={isLoading}
                        />
                        <button
                            type="submit"
                            disabled={!input.trim() || isLoading}
                            className="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-primary-glow hover:text-white disabled:opacity-50 disabled:hover:text-primary-glow transition-colors"
                        >
                            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    );
};
</file>

<file path="src/components/Chat/index.js">
export { ChatBot } from './ChatBot';
</file>

<file path="src/components/common/Icon.jsx">
/**
 * Icon Component
 * Renders SVG icons from the public/icons folder
 */

// Icon mapping for business types
export const BUSINESS_ICONS = {
  cafe: '/icons/cafe.svg',
  restaurant: '/icons/restaurant.svg',
  retail: '/icons/store.svg',
  gym: '/icons/gym.svg',
  pharmacy: '/icons/pharmacy.svg',
  salon: '/icons/salon.svg',
  electronics: '/icons/electronics.svg',
  clothing: '/icons/clothing.svg',
  bookstore: '/icons/book.svg',
  other: '/icons/building.svg',
};

// Icon mapping for proximity filters
export const PROXIMITY_ICONS = {
  near_metro: '/icons/metro.svg',
  near_bus: '/icons/bus.svg',
  near_school: '/icons/school.svg',
  near_college: '/icons/college.svg',
  near_hospital: '/icons/hospital.svg',
  near_mall: '/icons/mall.svg',
  near_office: '/icons/office.svg',
  near_residential: '/icons/house.svg',
  near_temple: '/icons/temple.svg',
  near_park: '/icons/park.svg',
  near_atm: '/icons/bank.svg',
  near_bar: '/icons/bar.svg',
};

// General icons
export const GENERAL_ICONS = {
  search: '/icons/search.svg',
  marker: '/icons/marker.svg',
  locationPin: '/icons/location-pin.svg',
  star: '/icons/star.svg',
};

/**
 * Icon component - renders SVG icons with customizable size and color
 */
export default function Icon({ 
  name, 
  src, 
  size = 24, 
  className = '',
  color = 'currentColor',
  style = {}
}) {
  // Determine the icon source
  const iconSrc = src || BUSINESS_ICONS[name] || PROXIMITY_ICONS[name] || GENERAL_ICONS[name];
  
  if (!iconSrc) {
    console.warn(`Icon not found: ${name}`);
    return null;
  }

  return (
    <img 
      src={iconSrc} 
      alt={name || 'icon'}
      width={size}
      height={size}
      className={`inline-block ${className}`}
      style={{ 
        filter: color !== 'currentColor' ? 'brightness(0) saturate(100%)' : undefined,
        ...style 
      }}
    />
  );
}

/**
 * Colored Icon component - applies color filter to SVG
 */
export function ColoredIcon({ 
  name, 
  src, 
  size = 24, 
  color = '#F5A623',
  className = '' 
}) {
  const iconSrc = src || BUSINESS_ICONS[name] || PROXIMITY_ICONS[name] || GENERAL_ICONS[name];
  
  if (!iconSrc) {
    return null;
  }

  // Convert hex color to CSS filter
  const getColorFilter = (hexColor) => {
    // Common color mappings
    const colorFilters = {
      '#F5A623': 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)', // orange
      '#10b981': 'invert(64%) sepia(44%) saturate(533%) hue-rotate(109deg) brightness(93%) contrast(88%)', // green
      '#f43f5e': 'invert(42%) sepia(93%) saturate(1352%) hue-rotate(326deg) brightness(99%) contrast(97%)', // red
      '#3b82f6': 'invert(47%) sepia(98%) saturate(1953%) hue-rotate(207deg) brightness(98%) contrast(94%)', // blue
      '#8b5cf6': 'invert(44%) sepia(94%) saturate(2670%) hue-rotate(243deg) brightness(95%) contrast(94%)', // purple
      '#ffffff': 'brightness(0) invert(1)', // white
      '#1E3A5F': 'invert(19%) sepia(29%) saturate(1039%) hue-rotate(178deg) brightness(92%) contrast(87%)', // dark blue
    };
    return colorFilters[hexColor] || '';
  };

  return (
    <img 
      src={iconSrc} 
      alt={name || 'icon'}
      width={size}
      height={size}
      className={`inline-block ${className}`}
      style={{ 
        filter: getColorFilter(color)
      }}
    />
  );
}
</file>

<file path="src/components/common/index.js">
/**
 * Common Components Index
 */

export { default as Icon, ColoredIcon, BUSINESS_ICONS, PROXIMITY_ICONS, GENERAL_ICONS } from './Icon';
</file>

<file path="src/components/Dashboard/AnalysisPanel.jsx">
/**
 * Analysis Panel Component
 * Combines all analysis cards in a slide-out panel
 */

import RecommendedSpotsCard from './RecommendedSpotsCard';
import CompetitorCard from './CompetitorCard';
import LandmarksCard from './LandmarksCard';

export default function AnalysisPanel({
  analysis,
  isLoading,
  isOpen,
  onClose,
  onViewSpot,
  onOpenChat
}) {
  if (!isOpen) return null;

  return (
    <>
      {/* Clickable backdrop - transparent, no blur to keep map visible */}
      <div
        className="fixed inset-0 z-40"
        onClick={onClose}
      />

      {/* Panel */}
      <div className="fixed right-0 top-0 h-full w-full max-w-md bg-slate-950/95 backdrop-blur-md border-l border-white/10 z-50 overflow-hidden flex flex-col animate-slide-in-right shadow-2xl shadow-black/50">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-white/10 bg-slate-900">
          <div>
            <h2 className="text-lg font-semibold text-slate-100">
              Location Analysis
            </h2>
            {analysis?.location && (
              <p className="text-sm text-slate-400 truncate max-w-[280px]">
                {analysis.location.name || analysis.address?.formatted_address || `${analysis.location.lat?.toFixed(4)}, ${analysis.location.lng?.toFixed(4)}`}
              </p>
            )}
          </div>
          <button
            onClick={onClose}
            className="w-8 h-8 flex items-center justify-center rounded-lg hover:bg-surface-secondary transition-colors text-slate-400 hover:text-slate-200"
          >
            <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Content */}
        <div className="flex-1 overflow-y-auto p-4 space-y-4">
          {/* Summary stats */}
          {!isLoading && analysis && (
            <div className="grid grid-cols-3 gap-2">
              <div className="glass-panel p-3 text-center">
                <div className="text-2xl font-bold text-emerald-400">
                  {analysis?.recommended_spots?.length || 0}
                </div>
                <div className="text-[10px] text-slate-500 uppercase tracking-wide">
                  Optimal Spots
                </div>
              </div>
              <div className="glass-panel p-3 text-center">
                <div className="text-2xl font-bold text-rose-400">
                  {analysis?.competitors?.count || 0}
                </div>
                <div className="text-[10px] text-slate-500 uppercase tracking-wide">
                  Competitors
                </div>
              </div>
              <div className="glass-panel p-3 text-center">
                <div className="text-2xl font-bold text-cyan-400">
                  {analysis?.landmarks?.total || 0}
                </div>
                <div className="text-[10px] text-slate-500 uppercase tracking-wide">
                  Landmarks
                </div>
              </div>
            </div>
          )}

          {/* Recommended Spots - Primary focus */}
          <RecommendedSpotsCard
            spots={analysis?.recommended_spots || []}
            isLoading={isLoading}
            onViewSpot={onViewSpot}
          />

          {/* Competitors */}
          <CompetitorCard
            competitors={analysis?.competitors?.nearby || []}
            isLoading={isLoading}
          />

          {/* Landmarks */}
          <LandmarksCard
            landmarks={analysis?.landmarks?.list || []}
            isLoading={isLoading}
          />

          {/* DIGIPIN */}
          {!isLoading && analysis?.location?.digipin && (
            <div className="glass-panel p-4">
              <h3 className="text-sm font-medium text-slate-400 mb-2 flex items-center gap-2">
                <img src="/icons/location-pin.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
                DIGIPIN
              </h3>
              <div className="bg-surface-secondary rounded-lg p-3">
                <p className="font-mono text-primary-glow text-lg tracking-wider text-center">
                  {analysis.location.digipin}
                </p>
              </div>
              <p className="text-xs text-slate-500 mt-2 text-center">
                India Post digital address
              </p>
            </div>
          )}
        </div>

        {/* Footer actions */}
        <div className="p-4 border-t border-surface-border bg-surface-elevated">
          <div className="grid grid-cols-2 gap-3">
            <button className="px-4 py-2 bg-surface-secondary text-slate-300 rounded-lg hover:bg-slate-700 transition-colors text-sm">
              Export Report
            </button>
            <button
              onClick={onOpenChat}
              className="btn-primary text-sm"
            >
              Ask AI Assistant
            </button>
          </div>
        </div>
      </div>
    </>
  );
}
</file>

<file path="src/components/Dashboard/Charts/CompetitorChart.jsx">
/**
 * Competitor Chart Component
 * Bar chart showing competitor distribution by category
 */

import { useMemo } from 'react';
import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  Tooltip,
  ResponsiveContainer,
  Cell,
} from 'recharts';

// Category colors
const CATEGORY_COLORS = {
  cafe: '#10b981',
  restaurant: '#f59e0b',
  retail: '#3b82f6',
  gym: '#8b5cf6',
  pharmacy: '#ec4899',
  salon: '#14b8a6',
  electronics: '#6366f1',
  clothing: '#f43f5e',
  default: '#64748b',
};

// Custom tooltip
const CustomTooltip = ({ active, payload }) => {
  if (!active || !payload || !payload.length) return null;

  const data = payload[0].payload;
  return (
    <div className="bg-canvas-base border border-surface-border rounded-lg p-3 shadow-glass">
      <p className="text-slate-200 font-medium">{data.name}</p>
      <p className="text-sm text-slate-400">
        <span className="text-destructive-glow font-semibold">{data.count}</span> competitors
      </p>
    </div>
  );
};

export default function CompetitorChart({ competitors = [], isLoading }) {
  // Safely convert to array
  const competitorList = Array.isArray(competitors) ? competitors : [];
  
  // Group competitors by category
  const chartData = useMemo(() => {
    const grouped = competitorList.reduce((acc, competitor) => {
      const category = competitor.category?.toLowerCase() || 'other';
      if (!acc[category]) {
        acc[category] = { name: category, count: 0 };
      }
      acc[category].count++;
      return acc;
    }, {});

    return Object.values(grouped)
      .sort((a, b) => b.count - a.count)
      .slice(0, 6); // Top 6 categories
  }, [competitorList]);

  if (isLoading) {
    return (
      <div className="glass-panel p-4">
        <div className="h-4 bg-slate-700 rounded w-32 mb-4 animate-pulse" />
        <div className="h-48 bg-slate-700/30 rounded animate-pulse" />
      </div>
    );
  }

  if (competitorList.length === 0) {
    return (
      <div className="glass-panel p-4">
        <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
          <img src="/icons/store.svg" alt="" className="w-4 h-4" style={{ filter: 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
          Competitor Distribution
        </h3>
        <div className="h-48 flex items-center justify-center text-slate-500">
          <div className="text-center">
            <img src="/icons/star.svg" alt="" className="w-8 h-8 mx-auto mb-2" style={{ filter: 'invert(74%) sepia(52%) saturate(579%) hue-rotate(93deg) brightness(95%) contrast(88%)' }} />
            <p>No competitors to show</p>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="glass-panel p-4">
      <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
        <img src="/icons/store.svg" alt="" className="w-4 h-4" style={{ filter: 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
        Competitor Distribution
      </h3>
      
      <div className="h-48">
        <ResponsiveContainer width="100%" height="100%">
          <BarChart
            data={chartData}
            layout="vertical"
            margin={{ top: 0, right: 0, bottom: 0, left: 0 }}
          >
            <XAxis 
              type="number" 
              hide 
              domain={[0, 'dataMax + 1']}
            />
            <YAxis
              type="category"
              dataKey="name"
              width={80}
              tick={{ fill: '#94a3b8', fontSize: 12 }}
              axisLine={false}
              tickLine={false}
              tickFormatter={(value) => 
                value.charAt(0).toUpperCase() + value.slice(1)
              }
            />
            <Tooltip content={<CustomTooltip />} cursor={false} />
            <Bar
              dataKey="count"
              radius={[0, 4, 4, 0]}
              maxBarSize={24}
            >
              {chartData.map((entry, index) => (
                <Cell
                  key={`cell-${index}`}
                  fill={CATEGORY_COLORS[entry.name] || CATEGORY_COLORS.default}
                  fillOpacity={0.8}
                />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </div>
      
      {/* Legend */}
      <div className="flex flex-wrap gap-2 mt-3 pt-3 border-t border-surface-border">
        {chartData.map((item) => (
          <div key={item.name} className="flex items-center gap-1.5 text-xs">
            <div
              className="w-2.5 h-2.5 rounded-sm"
              style={{ backgroundColor: CATEGORY_COLORS[item.name] || CATEGORY_COLORS.default }}
            />
            <span className="text-slate-500 capitalize">{item.name}</span>
          </div>
        ))}
      </div>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/Charts/index.js">
export { default as CompetitorChart } from './CompetitorChart';
export { default as LandmarkRadar } from './LandmarkRadar';
export { default as ScoreGauge } from './ScoreGauge';
</file>

<file path="src/components/Dashboard/Charts/LandmarkRadar.jsx">
/**
 * Landmark Radar Chart Component
 * Radar chart showing landmark category distribution
 */

import { useMemo } from 'react';
import {
  RadarChart,
  PolarGrid,
  PolarAngleAxis,
  PolarRadiusAxis,
  Radar,
  ResponsiveContainer,
  Tooltip,
} from 'recharts';

// Category configuration
const CATEGORY_CONFIG = {
  metro_station: { label: 'Metro', maxScore: 5 },
  bus_stop: { label: 'Bus', maxScore: 10 },
  school: { label: 'School', maxScore: 8 },
  college: { label: 'College', maxScore: 5 },
  hospital: { label: 'Hospital', maxScore: 5 },
  mall: { label: 'Mall', maxScore: 3 },
  office: { label: 'Office', maxScore: 10 },
  residential: { label: 'Residential', maxScore: 15 },
  temple: { label: 'Temple', maxScore: 5 },
  park: { label: 'Park', maxScore: 5 },
};

// Custom tooltip
const CustomTooltip = ({ active, payload }) => {
  if (!active || !payload || !payload.length) return null;

  const data = payload[0].payload;
  return (
    <div className="bg-canvas-base border border-surface-border rounded-lg p-3 shadow-glass">
      <p className="text-slate-200 font-medium">{data.fullLabel}</p>
      <p className="text-sm text-slate-400">
        <span className="text-primary-glow font-semibold">{data.count}</span> nearby
      </p>
    </div>
  );
};

export default function LandmarkRadar({ landmarks = [], isLoading }) {
  // Safely convert to array
  const landmarkList = Array.isArray(landmarks) ? landmarks : [];
  
  // Process landmarks into radar data
  const chartData = useMemo(() => {
    // Count landmarks by category
    const counts = landmarkList.reduce((acc, landmark) => {
      const category = landmark.category?.toLowerCase().replace(/\s+/g, '_') || 'other';
      acc[category] = (acc[category] || 0) + 1;
      return acc;
    }, {});

    // Convert to chart format with normalized values
    return Object.entries(CATEGORY_CONFIG).map(([key, config]) => {
      const count = counts[key] || 0;
      const normalized = Math.min(100, (count / config.maxScore) * 100);
      return {
        category: config.label,
        fullLabel: config.label,
        value: normalized,
        count,
      };
    });
  }, [landmarkList]);

  if (isLoading) {
    return (
      <div className="glass-panel p-4">
        <div className="h-4 bg-slate-700 rounded w-32 mb-4 animate-pulse" />
        <div className="h-64 bg-slate-700/30 rounded-full animate-pulse mx-auto w-64" />
      </div>
    );
  }

  if (landmarkList.length === 0) {
    return (
      <div className="glass-panel p-4">
        <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
          <img src="/icons/star.svg" alt="" className="w-4 h-4" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
          Landmark Coverage
        </h3>
        <div className="h-64 flex items-center justify-center text-slate-500">
          <div className="text-center">
            <img src="/icons/marker.svg" alt="" className="w-8 h-8 mx-auto mb-2 opacity-50" style={{ filter: 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
            <p>No landmarks detected</p>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="glass-panel p-4">
      <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
        <img src="/icons/star.svg" alt="" className="w-4 h-4" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
        Landmark Coverage
      </h3>
      
      <div className="h-64">
        <ResponsiveContainer width="100%" height="100%">
          <RadarChart data={chartData} margin={{ top: 20, right: 30, bottom: 20, left: 30 }}>
            <PolarGrid 
              stroke="#334155" 
              strokeOpacity={0.5}
            />
            <PolarAngleAxis
              dataKey="category"
              tick={{ fill: '#94a3b8', fontSize: 11 }}
              tickLine={false}
            />
            <PolarRadiusAxis
              angle={90}
              domain={[0, 100]}
              tick={false}
              axisLine={false}
            />
            <Tooltip content={<CustomTooltip />} />
            <Radar
              name="Coverage"
              dataKey="value"
              stroke="#10b981"
              fill="#10b981"
              fillOpacity={0.3}
              strokeWidth={2}
            />
          </RadarChart>
        </ResponsiveContainer>
      </div>
      
      {/* Summary */}
      <div className="mt-3 pt-3 border-t border-surface-border">
        <div className="flex items-center justify-between text-xs">
          <span className="text-slate-500">Total landmarks detected</span>
          <span className="text-primary-glow font-semibold">{landmarkList.length}</span>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/Charts/ScoreGauge.jsx">
/**
 * Score Gauge Component
 * Circular gauge visualization for opportunity score
 */

import { useMemo } from 'react';
import { PieChart, Pie, Cell, ResponsiveContainer } from 'recharts';

export default function ScoreGauge({ score = 0, size = 'md', showLabel = true, isLoading }) {
  const normalizedScore = Math.min(100, Math.max(0, score));
  
  // Determine color based on score
  const scoreColor = useMemo(() => {
    if (normalizedScore >= 70) return '#10b981'; // Green - Excellent
    if (normalizedScore >= 50) return '#06b6d4'; // Cyan - Good
    if (normalizedScore >= 30) return '#f59e0b'; // Amber - Fair
    return '#f43f5e'; // Rose - Poor
  }, [normalizedScore]);

  const scoreLabel = useMemo(() => {
    if (normalizedScore >= 70) return 'Excellent';
    if (normalizedScore >= 50) return 'Good';
    if (normalizedScore >= 30) return 'Fair';
    return 'Poor';
  }, [normalizedScore]);

  // Chart data for gauge effect
  const data = [
    { name: 'score', value: normalizedScore },
    { name: 'remaining', value: 100 - normalizedScore },
  ];

  // Size configurations
  const sizes = {
    sm: { width: 100, height: 100, inner: 35, outer: 45, fontSize: 'text-xl' },
    md: { width: 160, height: 160, inner: 55, outer: 70, fontSize: 'text-3xl' },
    lg: { width: 200, height: 200, inner: 70, outer: 90, fontSize: 'text-4xl' },
  };

  const config = sizes[size] || sizes.md;

  if (isLoading) {
    return (
      <div 
        className="relative flex items-center justify-center"
        style={{ width: config.width, height: config.height }}
      >
        <div 
          className="absolute rounded-full border-8 border-slate-700 animate-pulse"
          style={{ 
            width: config.outer * 2, 
            height: config.outer * 2,
          }}
        />
        <div className="w-8 h-8 border-2 border-slate-600 border-t-primary-glow rounded-full animate-spin" />
      </div>
    );
  }

  return (
    <div 
      className="relative"
      style={{ width: config.width, height: config.height }}
    >
      <ResponsiveContainer width="100%" height="100%">
        <PieChart>
          <Pie
            data={data}
            cx="50%"
            cy="50%"
            startAngle={180}
            endAngle={0}
            innerRadius={config.inner}
            outerRadius={config.outer}
            paddingAngle={0}
            dataKey="value"
            stroke="none"
          >
            <Cell fill={scoreColor} />
            <Cell fill="#1e293b" />
          </Pie>
        </PieChart>
      </ResponsiveContainer>
      
      {/* Center content */}
      <div className="absolute inset-0 flex flex-col items-center justify-center">
        <span 
          className={`font-bold ${config.fontSize} transition-colors duration-500`}
          style={{ color: scoreColor }}
        >
          {normalizedScore}
        </span>
        {showLabel && (
          <span 
            className="text-xs font-medium transition-colors duration-500 -mt-1"
            style={{ color: scoreColor }}
          >
            {scoreLabel}
          </span>
        )}
      </div>
      
      {/* Scale markers */}
      <div className="absolute bottom-0 left-0 right-0 flex justify-between px-2 text-xs text-slate-600">
        <span>0</span>
        <span>50</span>
        <span>100</span>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/CompetitorCard.jsx">
/**
 * Competitor Card Component
 * Displays nearby competitors with distance information
 */

import { useState } from 'react';

export default function CompetitorCard({ competitors = [], isLoading }) {
  const [showAll, setShowAll] = useState(false);
  
  // Ensure competitors is an array
  const competitorList = Array.isArray(competitors) ? competitors : [];
  
  // Sort by distance (closest first)
  const sortedCompetitors = [...competitorList].sort((a, b) => 
    (a.distance || 9999) - (b.distance || 9999)
  );
  
  // Show first 20 or all based on toggle
  const displayCount = showAll ? sortedCompetitors.length : Math.min(20, sortedCompetitors.length);
  const displayedCompetitors = sortedCompetitors.slice(0, displayCount);

  const getDistanceColor = (distance) => {
    if (distance <= 200) return 'text-destructive-glow';
    if (distance <= 500) return 'text-warning-glow';
    return 'text-slate-400';
  };

  const getDistanceLabel = (distance) => {
    if (distance >= 1000) {
      return `${(distance / 1000).toFixed(1)}km`;
    }
    return `${distance}m`;
  };

  return (
    <div className="glass-panel p-5">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-sm font-medium text-slate-400 flex items-center gap-2">
          <img src="/icons/store.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(42%) sepia(93%) saturate(1352%) hue-rotate(326deg) brightness(99%) contrast(97%)' }} />
          Nearby Competitors
        </h3>
        {!isLoading && (
          <span className="text-xs bg-destructive-glow/20 text-destructive-glow px-2 py-1 rounded-full">
            {competitors.length} found
          </span>
        )}
      </div>

      {isLoading ? (
        <div className="space-y-3">
          {[1, 2, 3].map((i) => (
            <div key={i} className="flex items-center gap-3">
              <div className="w-8 h-8 bg-slate-700 rounded-full animate-pulse" />
              <div className="flex-1">
                <div className="h-4 bg-slate-700 rounded animate-pulse w-3/4 mb-1" />
                <div className="h-3 bg-slate-700/50 rounded animate-pulse w-1/2" />
              </div>
            </div>
          ))}
        </div>
      ) : competitors.length === 0 ? (
        <div className="text-center py-6">
          <img src="/icons/star.svg" alt="" className="w-8 h-8 mx-auto mb-2" style={{ filter: 'invert(74%) sepia(52%) saturate(579%) hue-rotate(93deg) brightness(95%) contrast(88%)' }} />
          <p className="text-slate-400 text-sm">No competitors nearby!</p>
          <p className="text-slate-500 text-xs mt-1">Great opportunity zone</p>
        </div>
      ) : (
        <div className="space-y-2">
          <div className="max-h-80 overflow-y-auto space-y-2 pr-1">
            {displayedCompetitors.map((competitor, index) => (
              <div 
                key={index}
                className="flex items-start gap-3 p-2 rounded-lg hover:bg-surface-secondary transition-colors"
              >
                {/* Index badge */}
                <div className="w-6 h-6 bg-destructive-glow/20 text-destructive-glow rounded-full flex items-center justify-center text-xs font-medium flex-shrink-0">
                  {index + 1}
                </div>
                
                {/* Competitor info */}
                <div className="flex-1 min-w-0">
                  <p className="text-slate-200 text-sm truncate">{competitor.name}</p>
                  <p className="text-slate-500 text-xs truncate">{competitor.category}</p>
                </div>
                
                {/* Distance */}
                {competitor.distance !== undefined && (
                  <span className={`text-xs font-mono flex-shrink-0 ${getDistanceColor(competitor.distance)}`}>
                    {getDistanceLabel(competitor.distance)}
                  </span>
                )}
              </div>
            ))}
          </div>
          
          {/* Show more/less toggle */}
          {sortedCompetitors.length > 20 && (
            <button
              onClick={() => setShowAll(!showAll)}
              className="w-full text-center text-xs text-primary-glow hover:text-primary-glow/80 py-2 transition-colors"
            >
              {showAll 
                ? ` Show less` 
                : ` Show all ${sortedCompetitors.length} competitors`}
            </button>
          )}
        </div>
      )}
      
      {/* Competition density indicator */}
      {!isLoading && competitors.length > 0 && (
        <div className="mt-4 pt-4 border-t border-surface-border">
          <div className="flex items-center justify-between text-xs">
            <span className="text-slate-500">Competition Level</span>
            <span className={
              competitors.length >= 10 ? 'text-destructive-glow' :
              competitors.length >= 5 ? 'text-warning-glow' :
              'text-primary-glow'
            }>
              {competitors.length >= 10 ? 'High' : competitors.length >= 5 ? 'Medium' : 'Low'}
            </span>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/Dashboard/index.js">
export { default as ScoreCard } from './ScoreCard';
export { default as CompetitorCard } from './CompetitorCard';
export { default as LandmarksCard } from './LandmarksCard';
export { default as AnalysisPanel } from './AnalysisPanel';
export { default as MetricsGrid } from './MetricsGrid';
export { default as LoadingProgress } from './LoadingProgress';
export { default as RecommendedSpotsCard } from './RecommendedSpotsCard';
export * from './Charts';
</file>

<file path="src/components/Dashboard/LandmarksCard.jsx">
/**
 * Landmarks Card Component
 * Displays nearby landmarks grouped by category with footfall indicators
 */

import { useState } from 'react';

// Landmark category icons and weights - using SVG icons
const CATEGORY_CONFIG = {
  metro_station: { icon: '/icons/metro.svg', label: 'Metro Station', weight: 5 },
  metro: { icon: '/icons/metro.svg', label: 'Metro Station', weight: 5 },
  bus_stop: { icon: '/icons/bus.svg', label: 'Bus Stop', weight: 3 },
  bus: { icon: '/icons/bus.svg', label: 'Bus Stop', weight: 3 },
  railway_station: { icon: '/icons/metro.svg', label: 'Railway', weight: 5 },
  railway: { icon: '/icons/metro.svg', label: 'Railway', weight: 5 },
  school: { icon: '/icons/school.svg', label: 'School', weight: 4 },
  college: { icon: '/icons/college.svg', label: 'College', weight: 4 },
  university: { icon: '/icons/college.svg', label: 'University', weight: 4 },
  hospital: { icon: '/icons/hospital.svg', label: 'Hospital', weight: 4 },
  clinic: { icon: '/icons/hospital.svg', label: 'Clinic', weight: 3 },
  mall: { icon: '/icons/mall.svg', label: 'Mall', weight: 5 },
  office: { icon: '/icons/office.svg', label: 'Office', weight: 4 },
  residential: { icon: '/icons/house.svg', label: 'Residential', weight: 3 },
  temple: { icon: '/icons/temple.svg', label: 'Temple/Church', weight: 3 },
  church: { icon: '/icons/temple.svg', label: 'Church', weight: 3 },
  mosque: { icon: '/icons/temple.svg', label: 'Mosque', weight: 3 },
  park: { icon: '/icons/park.svg', label: 'Park', weight: 2 },
  atm: { icon: '/icons/bank.svg', label: 'ATM', weight: 2 },
  bank: { icon: '/icons/bank.svg', label: 'Bank', weight: 3 },
  bar: { icon: '/icons/bar.svg', label: 'Bar/Pub', weight: 3 },
  pub: { icon: '/icons/bar.svg', label: 'Bar/Pub', weight: 3 },
  restaurant: { icon: '/icons/restaurant.svg', label: 'Restaurant', weight: 3 },
  cafe: { icon: '/icons/cafe.svg', label: 'Cafe', weight: 3 },
  hotel: { icon: '/icons/building.svg', label: 'Hotel', weight: 4 },
  pharmacy: { icon: '/icons/pharmacy.svg', label: 'Pharmacy', weight: 3 },
  gym: { icon: '/icons/gym.svg', label: 'Gym', weight: 3 },
  supermarket: { icon: '/icons/mall.svg', label: 'Supermarket', weight: 3 },
  nearby: { icon: '/icons/marker.svg', label: 'Nearby Places', weight: 2 },
  // Default fallback
  default: { icon: '/icons/marker.svg', label: 'Other', weight: 1 },
};

export default function LandmarksCard({ landmarks = [], isLoading }) {
  const [showAllLandmarks, setShowAllLandmarks] = useState(false);
  
  // Ensure landmarks is an array
  const landmarkList = Array.isArray(landmarks) ? landmarks : [];
  
  // Group landmarks by category
  const groupedLandmarks = landmarkList.reduce((acc, landmark) => {
    const category = landmark.category?.toLowerCase().replace(/\s+/g, '_') || 'default';
    if (!acc[category]) {
      acc[category] = [];
    }
    acc[category].push(landmark);
    return acc;
  }, {});

  // Sort categories by weight (highest first)
  const sortedCategories = Object.entries(groupedLandmarks).sort((a, b) => {
    const configA = CATEGORY_CONFIG[a[0]] || CATEGORY_CONFIG.default;
    const configB = CATEGORY_CONFIG[b[0]] || CATEGORY_CONFIG.default;
    return configB.weight - configA.weight;
  });

  // Calculate total footfall value
  const totalFootfallValue = landmarkList.reduce((total, landmark) => {
    const category = landmark.category?.toLowerCase().replace(/\s+/g, '_') || 'default';
    const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG.default;
    return total + config.weight;
  }, 0);

  const getFootfallLevel = (value) => {
    if (value >= 30) return { label: 'High', color: 'text-primary-glow' };
    if (value >= 15) return { label: 'Medium', color: 'text-accent-glow' };
    return { label: 'Low', color: 'text-warning-glow' };
  };

  return (
    <div className="glass-panel p-5">
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-sm font-medium text-slate-400 flex items-center gap-2">
          <img src="/icons/building.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(70%) sepia(98%) saturate(500%) hue-rotate(152deg) brightness(97%) contrast(90%)' }} />
          Nearby Landmarks
        </h3>
        {!isLoading && (
          <span className="text-xs bg-primary-glow/20 text-primary-glow px-2 py-1 rounded-full">
            {landmarkList.length} found
          </span>
        )}
      </div>

      {isLoading ? (
        <div className="space-y-3">
          {[1, 2, 3, 4].map((i) => (
            <div key={i} className="flex items-center gap-3">
              <div className="w-8 h-8 bg-slate-700 rounded-lg animate-pulse" />
              <div className="flex-1">
                <div className="h-4 bg-slate-700 rounded animate-pulse w-20 mb-1" />
                <div className="h-3 bg-slate-700/50 rounded animate-pulse w-12" />
              </div>
            </div>
          ))}
        </div>
      ) : landmarkList.length === 0 ? (
        <div className="text-center py-6">
          <img src="/icons/marker.svg" alt="" className="w-8 h-8 mx-auto mb-2 opacity-50" style={{ filter: 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
          <p className="text-slate-400 text-sm">No landmarks nearby</p>
          <p className="text-slate-500 text-xs mt-1">May indicate low footfall area</p>
        </div>
      ) : (
        <div className="space-y-2">
          {/* Category Summary */}
          <div className="space-y-2 max-h-48 overflow-y-auto">
            {sortedCategories.map(([category, items]) => {
              const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG.default;
              return (
                <div 
                  key={category}
                  className="flex items-center gap-3 p-2 rounded-lg hover:bg-surface-secondary transition-colors"
                >
                  {/* Category icon */}
                  <div className="w-8 h-8 bg-surface-secondary rounded-lg flex items-center justify-center">
                    <img 
                      src={config.icon} 
                      alt="" 
                      className="w-5 h-5"
                      style={{ filter: 'invert(70%) sepia(98%) saturate(500%) hue-rotate(152deg) brightness(97%) contrast(90%)' }}
                    />
                  </div>
                  
                  {/* Category info */}
                  <div className="flex-1 min-w-0">
                    <p className="text-slate-200 text-sm">{config.label}</p>
                    <p className="text-slate-500 text-xs">{items.length} nearby</p>
                  </div>
                  
                  {/* Weight indicator */}
                  <div className="flex gap-0.5">
                    {[1, 2, 3, 4, 5].map((dot) => (
                      <div
                        key={dot}
                        className={`w-1.5 h-1.5 rounded-full ${
                          dot <= config.weight ? 'bg-primary-glow' : 'bg-slate-700'
                        }`}
                      />
                    ))}
                  </div>
                </div>
              );
            })}
          </div>
          
          {/* Show All Landmarks Button */}
          {showAllLandmarks ? (
            <div className="mt-3 pt-3 border-t border-surface-border">
              <button
                onClick={() => setShowAllLandmarks(false)}
                className="text-xs text-primary-glow hover:text-primary-glow/80 mb-2"
              >
                 Hide individual landmarks
              </button>
              <div className="space-y-1 max-h-48 overflow-y-auto">
                {landmarkList.map((landmark, idx) => {
                  const category = landmark.category?.toLowerCase().replace(/\s+/g, '_') || 'default';
                  const config = CATEGORY_CONFIG[category] || CATEGORY_CONFIG.default;
                  return (
                    <div key={idx} className="flex items-center gap-2 p-1.5 text-xs rounded hover:bg-surface-secondary">
                      <img 
                        src={config.icon} 
                        alt="" 
                        className="w-4 h-4 flex-shrink-0"
                        style={{ filter: 'invert(70%) sepia(98%) saturate(500%) hue-rotate(152deg) brightness(97%) contrast(90%)' }}
                      />
                      <span className="text-slate-300 truncate flex-1">{landmark.name}</span>
                      {landmark.distance && (
                        <span className="text-slate-500">{landmark.distance}m</span>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
          ) : (
            <button
              onClick={() => setShowAllLandmarks(true)}
              className="w-full text-xs text-primary-glow hover:text-primary-glow/80 mt-2 py-1"
            >
               Show all {landmarkList.length} landmarks
            </button>
          )}
        </div>
      )}
      
      {/* Footfall value indicator */}
      {!isLoading && landmarkList.length > 0 && (
        <div className="mt-4 pt-4 border-t border-surface-border">
          <div className="flex items-center justify-between text-xs">
            <span className="text-slate-500">Footfall Potential</span>
            <span className={getFootfallLevel(totalFootfallValue).color}>
              {getFootfallLevel(totalFootfallValue).label}
              <span className="text-slate-600 ml-1">({totalFootfallValue} pts)</span>
            </span>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/Dashboard/LoadingProgress.jsx">
/**
 * LoadingProgress Component - Compact Top-Right Loader
 * Glass-morphic floating card showing dynamic step-by-step progress
 */

// Define all analysis steps in order
const ANALYSIS_STEPS = [
  { id: 'validation', label: 'Validating location', icon: '' },
  { id: 'boundary', label: 'Area boundary loaded', icon: '' },
  { id: 'analysis', label: 'Analyzing location', icon: '' },
  { id: 'competitors', label: 'Competitors found', icon: '' },
  { id: 'landmarks', label: 'Landmarks identified', icon: '' },
  { id: 'digipin', label: 'Location code retrieved', icon: '' },
  { id: 'spots', label: 'Optimal spots found', icon: '' },
];

// Get step index for comparison
const getStepIndex = (stepId) => {
  const index = ANALYSIS_STEPS.findIndex(s => s.id === stepId);
  return index === -1 ? -1 : index;
};

export default function LoadingProgress({ status, isLoading }) {
  if (!isLoading && status.step === '') return null;

  const { step, message, progress, details } = status;

  // Don't render if complete and not loading
  if (step === 'complete' && !isLoading) return null;

  const currentStepIndex = getStepIndex(step);

  return (
    <div className="fixed top-6 right-6 z-50 animate-fadeIn">
      <div className="backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-4 shadow-2xl shadow-black/30 min-w-[300px] max-w-[340px]">
        {/* Header with spinner */}
        <div className="flex items-center gap-3 mb-3">
          {/* Spinning Emerald Ring */}
          {isLoading && step !== 'complete' && step !== 'error' && (
            <div className="relative w-10 h-10 flex-shrink-0">
              <div className="absolute inset-0 rounded-full border-2 border-emerald-500/20" />
              <div className="absolute inset-0 rounded-full border-2 border-transparent border-t-emerald-400 animate-spin" />
              <div className="absolute inset-2 rounded-full bg-emerald-500/10 flex items-center justify-center">
                <div className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse" />
              </div>
            </div>
          )}
          
          {/* Completion icon */}
          {step === 'complete' && (
            <div className="w-10 h-10 rounded-full bg-emerald-500/20 border border-emerald-500/30 flex items-center justify-center flex-shrink-0">
              <svg className="w-5 h-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" />
              </svg>
            </div>
          )}
          
          {/* Error icon */}
          {step === 'error' && (
            <div className="w-10 h-10 rounded-full bg-rose-500/20 border border-rose-500/30 flex items-center justify-center flex-shrink-0">
              <svg className="w-5 h-5 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
              </svg>
            </div>
          )}

          {/* Status text */}
          <div className="flex-1 min-w-0">
            <p className="text-sm font-medium text-white truncate">
              {step === 'complete' ? 'Analysis Complete!' : step === 'error' ? 'Analysis Failed' : 'Processing...'}
            </p>
            <p className="text-xs text-slate-400 truncate">{message}</p>
          </div>

          {/* Progress percentage */}
          <div className="text-right flex-shrink-0">
            <span className="text-lg font-bold text-emerald-400">{progress}%</span>
          </div>
        </div>

        {/* Progress Bar */}
        <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden mb-3">
          <div 
            className="h-full bg-gradient-to-r from-emerald-500 via-cyan-400 to-emerald-500 transition-all duration-500 ease-out rounded-full"
            style={{ width: `${progress}%` }}
          />
        </div>

        {/* Step-by-step checklist */}
        <div className="space-y-1.5 max-h-[200px] overflow-y-auto">
          {ANALYSIS_STEPS.map((analysisStep, index) => {
            const stepIndex = getStepIndex(analysisStep.id);
            const isCompleted = currentStepIndex > stepIndex || step === 'complete';
            const isCurrent = currentStepIndex === stepIndex && step !== 'complete' && step !== 'error';
            const isPending = currentStepIndex < stepIndex && step !== 'complete';
            
            // Get dynamic detail from the details array for completed steps
            const detail = details.find(d => d.includes(analysisStep.icon));
            const displayLabel = detail ? detail.replace(analysisStep.icon, '').trim() : analysisStep.label;
            
            return (
              <div 
                key={analysisStep.id} 
                className={`flex items-center gap-2.5 text-xs py-1 px-2 rounded-lg transition-all duration-300 ${
                  isCompleted ? 'bg-emerald-500/10 text-emerald-400' :
                  isCurrent ? 'bg-cyan-500/10 text-cyan-400' :
                  'bg-transparent text-slate-500'
                }`}
              >
                {/* Status indicator */}
                <div className="flex-shrink-0 w-5 h-5 flex items-center justify-center">
                  {isCompleted ? (
                    <div className="w-4 h-4 rounded-full bg-emerald-500/30 border border-emerald-400/50 flex items-center justify-center">
                      <svg className="w-2.5 h-2.5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={3}>
                        <path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7" />
                      </svg>
                    </div>
                  ) : isCurrent ? (
                    <div className="w-4 h-4 rounded-full border-2 border-cyan-400/50 border-t-cyan-400 animate-spin" />
                  ) : (
                    <div className="w-3 h-3 rounded-full border border-slate-600 bg-slate-800/50" />
                  )}
                </div>
                
                {/* Icon */}
                <span className="flex-shrink-0">{analysisStep.icon}</span>
                
                {/* Label */}
                <span className={`truncate ${isCompleted ? 'font-medium' : ''}`}>
                  {displayLabel}
                </span>
              </div>
            );
          })}
        </div>

        {/* Completion hint */}
        {step === 'complete' && (
          <p className="text-xs text-emerald-400/80 mt-3 pt-2 border-t border-white/5">
             Click anywhere to view detailed results 
          </p>
        )}
        
        {/* Error hint */}
        {step === 'error' && (
          <p className="text-xs text-rose-400/80 mt-3 pt-2 border-t border-white/5">
             Please try again with a different location.
          </p>
        )}
      </div>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/MetricsGrid.jsx">
/**
 * Metrics Grid Component
 * Displays key metrics in a compact grid layout
 */

// Icon paths for metrics
const METRIC_ICONS = {
  footfall: '/icons/marker.svg',
  competitors: '/icons/store.svg',
  landmarks: '/icons/building.svg',
  density: '/icons/marker.svg',
};

// Icon color filters
const ICON_FILTERS = {
  primary: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)',
  destructive: 'invert(42%) sepia(93%) saturate(1352%) hue-rotate(326deg) brightness(99%) contrast(97%)',
  accent: 'invert(70%) sepia(98%) saturate(500%) hue-rotate(152deg) brightness(97%) contrast(90%)',
  warning: 'invert(74%) sepia(57%) saturate(579%) hue-rotate(10deg) brightness(103%) contrast(101%)',
};

export default function MetricsGrid({ analysis, isLoading }) {
  const metrics = [
    {
      id: 'footfall',
      label: 'Footfall Index',
      value: analysis?.footfall_index || 0,
      max: 100,
      icon: METRIC_ICONS.footfall,
      color: 'primary',
      description: 'Estimated foot traffic potential',
    },
    {
      id: 'competitors',
      label: 'Competitors',
      value: analysis?.competitors?.length || 0,
      suffix: ' nearby',
      icon: METRIC_ICONS.competitors,
      color: 'destructive',
      description: 'Same category businesses',
    },
    {
      id: 'landmarks',
      label: 'Landmarks',
      value: analysis?.landmarks?.length || 0,
      suffix: ' found',
      icon: METRIC_ICONS.landmarks,
      color: 'accent',
      description: 'Key locations nearby',
    },
    {
      id: 'density',
      label: 'Competition Density',
      value: analysis?.competitor_density?.toFixed(1) || '0.0',
      suffix: '/km',
      icon: METRIC_ICONS.density,
      color: 'warning',
      description: 'Competitors per square km',
    },
  ];

  const getColorClasses = (color) => {
    const colors = {
      primary: 'text-primary-glow bg-primary-glow/10 border-primary-glow/30',
      destructive: 'text-destructive-glow bg-destructive-glow/10 border-destructive-glow/30',
      accent: 'text-accent-glow bg-accent-glow/10 border-accent-glow/30',
      warning: 'text-warning-glow bg-warning-glow/10 border-warning-glow/30',
    };
    return colors[color] || colors.primary;
  };

  if (isLoading) {
    return (
      <div className="grid grid-cols-2 gap-3">
        {[1, 2, 3, 4].map((i) => (
          <div key={i} className="glass-card p-4 animate-pulse">
            <div className="flex items-center gap-2 mb-2">
              <div className="w-8 h-8 bg-slate-700 rounded-lg" />
              <div className="h-4 bg-slate-700 rounded w-20" />
            </div>
            <div className="h-6 bg-slate-700 rounded w-16 mb-1" />
            <div className="h-3 bg-slate-700/50 rounded w-24" />
          </div>
        ))}
      </div>
    );
  }

  return (
    <div className="grid grid-cols-2 gap-3">
      {metrics.map((metric) => (
        <div
          key={metric.id}
          className="glass-card p-4 hover:bg-surface-elevated transition-colors group"
        >
          {/* Header */}
          <div className="flex items-center gap-2 mb-2">
            <div className={`w-8 h-8 rounded-lg flex items-center justify-center border ${getColorClasses(metric.color)}`}>
              <img 
                src={metric.icon} 
                alt="" 
                className="w-5 h-5"
                style={{ filter: ICON_FILTERS[metric.color] }}
              />
            </div>
            <span className="text-xs text-slate-500 font-medium uppercase tracking-wide">
              {metric.label}
            </span>
          </div>
          
          {/* Value */}
          <div className="flex items-baseline gap-1">
            <span className={`text-2xl font-bold ${getColorClasses(metric.color).split(' ')[0]}`}>
              {metric.value}
            </span>
            {metric.suffix && (
              <span className="text-sm text-slate-500">{metric.suffix}</span>
            )}
            {metric.max && (
              <span className="text-sm text-slate-600">/{metric.max}</span>
            )}
          </div>
          
          {/* Description (on hover) */}
          <p className="text-xs text-slate-600 mt-1 group-hover:text-slate-500 transition-colors">
            {metric.description}
          </p>
        </div>
      ))}
    </div>
  );
}
</file>

<file path="src/components/Dashboard/RecommendedSpotsCard.jsx">
/**
 * Recommended Spots Card Component
 * Displays optimal locations for setting up a business based on analysis
 */

import { useState } from 'react';

// Rating badge component
const RatingBadge = ({ rating, color }) => {
  const colorClasses = {
    green: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',
    cyan: 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30',
    yellow: 'bg-amber-500/20 text-amber-400 border-amber-500/30',
    orange: 'bg-orange-500/20 text-orange-400 border-orange-500/30',
  };
  
  return (
    <span className={`px-2 py-0.5 text-xs font-medium rounded-full border ${colorClasses[color] || colorClasses.cyan}`}>
      {rating}
    </span>
  );
};

// Individual spot card
const SpotItem = ({ spot, index, isExpanded, onToggle, onViewOnMap }) => {
  const rankColors = {
    1: 'from-emerald-500 to-emerald-600',
    2: 'from-cyan-500 to-cyan-600',
    3: 'from-blue-500 to-blue-600',
    4: 'from-purple-500 to-purple-600',
    5: 'from-slate-500 to-slate-600',
  };

  return (
    <div 
      className={`rounded-lg border transition-all duration-200 ${
        isExpanded 
          ? 'bg-surface-elevated border-primary-glow/30' 
          : 'bg-surface-secondary border-surface-border hover:border-slate-600'
      }`}
    >
      {/* Header - always visible */}
      <button
        onClick={onToggle}
        className="w-full flex items-center gap-3 p-3 text-left"
      >
        {/* Rank badge */}
        <div className={`w-8 h-8 rounded-lg bg-gradient-to-br ${rankColors[spot.rank] || rankColors[5]} flex items-center justify-center text-white font-bold text-sm shadow-lg`}>
          {spot.rank}
        </div>
        
        {/* Location info */}
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <span className="text-slate-200 font-medium">Spot #{spot.rank}</span>
            <RatingBadge rating={spot.rating} color={spot.rating_color} />
          </div>
          <p className="text-xs text-slate-500 font-mono truncate">
            {spot.lat}, {spot.lng}
          </p>
        </div>
        
        {/* Score */}
        <div className="text-right">
          <div className="text-lg font-bold text-primary-glow">{Math.round(spot.score)}</div>
          <div className="text-[10px] text-slate-500 uppercase tracking-wide">Score</div>
        </div>
        
        {/* Expand indicator */}
        <svg 
          className={`w-4 h-4 text-slate-500 transition-transform ${isExpanded ? 'rotate-180' : ''}`} 
          fill="none" 
          viewBox="0 0 24 24" 
          stroke="currentColor"
        >
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      
      {/* Expanded content */}
      {isExpanded && (
        <div className="px-3 pb-3 space-y-3 border-t border-surface-border pt-3">
          {/* Stats row */}
          <div className="grid grid-cols-2 gap-2">
            <div className="bg-surface-secondary rounded-lg p-2 text-center">
              <div className="text-rose-400 font-semibold">{spot.nearby_competitors}</div>
              <div className="text-[10px] text-slate-500">Competitors Nearby</div>
            </div>
            <div className="bg-surface-secondary rounded-lg p-2 text-center">
              <div className="text-cyan-400 font-semibold">{spot.nearby_landmarks}</div>
              <div className="text-[10px] text-slate-500">Landmarks</div>
            </div>
          </div>
          
          {/* Distance to nearest competitor */}
          {spot.min_competitor_distance && (
            <div className="flex items-center gap-2 text-xs">
              <span className="text-slate-500">Nearest competitor:</span>
              <span className={`font-medium ${spot.min_competitor_distance > 300 ? 'text-emerald-400' : 'text-amber-400'}`}>
                {spot.min_competitor_distance}m away
              </span>
            </div>
          )}
          
          {/* Reasons */}
          <div className="space-y-1.5">
            <p className="text-xs text-slate-400 font-medium">Why this spot:</p>
            <ul className="space-y-1">
              {spot.reasons.map((reason, i) => (
                <li key={i} className="flex items-start gap-2 text-xs text-slate-300">
                  <svg className="w-3 h-3 text-emerald-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                  </svg>
                  <span>{reason}</span>
                </li>
              ))}
            </ul>
          </div>
          
          {/* Action button */}
          <button
            onClick={(e) => {
              e.stopPropagation();
              onViewOnMap(spot);
            }}
            className="w-full py-2 bg-primary-glow/10 hover:bg-primary-glow/20 text-primary-glow text-xs font-medium rounded-lg transition-colors flex items-center justify-center gap-2"
          >
            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            View on Map
          </button>
        </div>
      )}
    </div>
  );
};

export default function RecommendedSpotsCard({ spots = [], isLoading, onViewSpot }) {
  const [expandedIndex, setExpandedIndex] = useState(0); // First spot expanded by default

  if (isLoading) {
    return (
      <div className="glass-panel p-5">
        <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
          <img src="/icons/star.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
          Recommended Locations
        </h3>
        <div className="space-y-3">
          {[1, 2, 3].map((i) => (
            <div key={i} className="bg-surface-secondary rounded-lg p-4 animate-pulse">
              <div className="flex items-center gap-3">
                <div className="w-8 h-8 rounded-lg bg-slate-700" />
                <div className="flex-1">
                  <div className="h-4 bg-slate-700 rounded w-24 mb-2" />
                  <div className="h-3 bg-slate-700/50 rounded w-32" />
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    );
  }

  if (!spots || spots.length === 0) {
    return (
      <div className="glass-panel p-5">
        <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
          <img src="/icons/star.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
          Recommended Locations
        </h3>
        <div className="text-center py-8">
          <img src="/icons/search.svg" alt="" className="w-12 h-12 mx-auto mb-3 opacity-50" style={{ filter: 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
          <p className="text-slate-400 text-sm">
            No optimal spots found in this area.
          </p>
          <p className="text-slate-500 text-xs mt-1">
            Try expanding the search radius or selecting a different area.
          </p>
        </div>
      </div>
    );
  }

  const topSpot = spots[0];

  return (
    <div className="glass-panel p-5">
      {/* Header */}
      <div className="flex items-center justify-between mb-4">
        <h3 className="text-sm font-medium text-slate-400 flex items-center gap-2">
          <img src="/icons/star.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
          Recommended Locations
        </h3>
        <span className="px-2 py-1 bg-emerald-500/20 text-emerald-400 text-xs rounded-full font-medium">
          {spots.length} spots found
        </span>
      </div>
      
      {/* Best spot highlight */}
      {topSpot && (
        <div className="mb-4 p-3 rounded-lg bg-gradient-to-r from-emerald-500/10 to-cyan-500/10 border border-emerald-500/20">
          <div className="flex items-center gap-2 mb-1">
            <img src="/icons/star.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(74%) sepia(52%) saturate(579%) hue-rotate(93deg) brightness(95%) contrast(88%)' }} />
            <span className="text-emerald-400 font-semibold text-sm">Best Location Found</span>
          </div>
          <p className="text-xs text-slate-300">
            {topSpot.reasons[0] || 'Optimal balance of low competition and good footfall'}
          </p>
        </div>
      )}
      
      {/* Spots list */}
      <div className="space-y-2 max-h-[400px] overflow-y-auto custom-scrollbar">
        {spots.map((spot, index) => (
          <SpotItem
            key={`spot-${spot.rank}`}
            spot={spot}
            index={index}
            isExpanded={expandedIndex === index}
            onToggle={() => setExpandedIndex(expandedIndex === index ? -1 : index)}
            onViewOnMap={onViewSpot}
          />
        ))}
      </div>
      
      {/* Legend */}
      <div className="mt-4 pt-3 border-t border-surface-border">
        <p className="text-[10px] text-slate-500 text-center">
          Spots are ranked by opportunity score: low competition + high footfall = better
        </p>
      </div>
    </div>
  );
}
</file>

<file path="src/components/Dashboard/ScoreCard.jsx">
/**
 * Score Card Component
 * Displays the Opportunity Score with a radial progress ring
 */

export default function ScoreCard({ score, label, isLoading }) {
  // Score should be 0-100
  const normalizedScore = Math.min(100, Math.max(0, score || 0));
  
  // Calculate stroke-dasharray for progress ring
  const radius = 45;
  const circumference = 2 * Math.PI * radius;
  const strokeDashoffset = circumference - (normalizedScore / 100) * circumference;
  
  // Determine color based on score
  const getScoreColor = (score) => {
    if (score >= 70) return '#10b981'; // Green - Excellent
    if (score >= 50) return '#06b6d4'; // Cyan - Good
    if (score >= 30) return '#f59e0b'; // Amber - Fair
    return '#f43f5e'; // Rose - Poor
  };
  
  const getScoreLabel = (score) => {
    if (score >= 70) return 'Excellent';
    if (score >= 50) return 'Good';
    if (score >= 30) return 'Fair';
    return 'Poor';
  };
  
  const scoreColor = getScoreColor(normalizedScore);
  const scoreLabel = getScoreLabel(normalizedScore);

  return (
    <div className="glass-panel p-5">
      <h3 className="text-sm font-medium text-slate-400 mb-4 flex items-center gap-2">
        <img src="/icons/star.svg" alt="" className="w-5 h-5" style={{ filter: 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' }} />
        Opportunity Score
      </h3>
      
      <div className="flex items-center gap-6">
        {/* Radial Progress Ring */}
        <div className="relative w-28 h-28">
          <svg className="w-full h-full transform -rotate-90">
            {/* Background circle */}
            <circle
              cx="56"
              cy="56"
              r={radius}
              stroke="currentColor"
              strokeWidth="8"
              fill="none"
              className="text-slate-700"
            />
            {/* Progress circle */}
            <circle
              cx="56"
              cy="56"
              r={radius}
              stroke={isLoading ? '#475569' : scoreColor}
              strokeWidth="8"
              fill="none"
              strokeLinecap="round"
              strokeDasharray={circumference}
              strokeDashoffset={isLoading ? circumference : strokeDashoffset}
              className="transition-all duration-1000 ease-out"
              style={{
                filter: isLoading ? 'none' : `drop-shadow(0 0 8px ${scoreColor}80)`,
              }}
            />
          </svg>
          
          {/* Center text */}
          <div className="absolute inset-0 flex flex-col items-center justify-center">
            {isLoading ? (
              <div className="w-8 h-8 border-2 border-slate-600 border-t-primary-glow rounded-full animate-spin" />
            ) : (
              <>
                <span 
                  className="text-3xl font-bold transition-colors duration-500"
                  style={{ color: scoreColor }}
                >
                  {normalizedScore}
                </span>
                <span className="text-xs text-slate-500">/100</span>
              </>
            )}
          </div>
        </div>
        
        {/* Score details */}
        <div className="flex-1 space-y-2">
          {isLoading ? (
            <div className="space-y-2">
              <div className="h-5 bg-slate-700 rounded animate-pulse w-24" />
              <div className="h-4 bg-slate-700/50 rounded animate-pulse w-32" />
            </div>
          ) : (
            <>
              <p 
                className="text-lg font-semibold transition-colors duration-500"
                style={{ color: scoreColor }}
              >
                {scoreLabel}
              </p>
              {label && (
                <p className="text-sm text-slate-400">{label}</p>
              )}
            </>
          )}
        </div>
      </div>
      
      {/* Score breakdown hint */}
      {!isLoading && score !== undefined && (
        <div className="mt-4 pt-4 border-t border-surface-border">
          <p className="text-xs text-slate-500">
            Based on footfall, competitor density & nearby landmarks
          </p>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/Filters/BusinessTypeSelector.jsx">
/**
 * Business Type Selector Component - Icon Grid Design
 * Glass-morphic 2-column grid of Icon Cards
 */

import { useState, useRef, useEffect } from 'react';
import { BUSINESS_ICONS } from '../common/Icon';

// Business type options with SVG icons
const BUSINESS_TYPES = [
  { id: 'cafe', label: 'Cafe', icon: BUSINESS_ICONS.cafe },
  { id: 'restaurant', label: 'Restaurant', icon: BUSINESS_ICONS.restaurant },
  { id: 'retail', label: 'Retail', icon: BUSINESS_ICONS.retail },
  { id: 'gym', label: 'Gym', icon: BUSINESS_ICONS.gym },
  { id: 'pharmacy', label: 'Pharmacy', icon: BUSINESS_ICONS.pharmacy },
  { id: 'salon', label: 'Salon', icon: BUSINESS_ICONS.salon },
  { id: 'electronics', label: 'Electronics', icon: BUSINESS_ICONS.electronics },
  { id: 'clothing', label: 'Clothing', icon: BUSINESS_ICONS.clothing },
  { id: 'bookstore', label: 'Bookstore', icon: BUSINESS_ICONS.bookstore },
  { id: 'other', label: 'Other', icon: BUSINESS_ICONS.other },
];

export default function BusinessTypeSelector({ value, onChange, disabled }) {
  const [customType, setCustomType] = useState('');
  const [showCustomInput, setShowCustomInput] = useState(false);

  const handleSelect = (type) => {
    if (disabled) return;
    
    if (type.id === 'other') {
      setShowCustomInput(true);
      onChange(type.id);
    } else {
      setShowCustomInput(false);
      onChange(type.id);
    }
  };

  const handleCustomSubmit = (e) => {
    e.preventDefault();
    if (customType.trim()) {
      onChange(customType.trim().toLowerCase());
      setShowCustomInput(false);
    }
  };

  const selectedType = BUSINESS_TYPES.find((t) => t.id === value);

  return (
    <div className="space-y-3">
      <div className="flex items-center justify-between">
        <label className="text-sm font-medium text-slate-300">
          What are you opening?
        </label>
        {value && value !== 'other' && (
          <span className="text-xs text-emerald-400 bg-emerald-500/10 px-2 py-1 rounded-full border border-emerald-500/20">
            {selectedType?.label || value}
          </span>
        )}
      </div>

      {/* 2-Column Icon Grid */}
      <div className={`grid grid-cols-2 gap-2 ${disabled ? 'opacity-50 pointer-events-none' : ''}`}>
        {BUSINESS_TYPES.map((type) => {
          const isActive = value === type.id;
          return (
            <button
              key={type.id}
              type="button"
              onClick={() => handleSelect(type)}
              className={`
                relative flex flex-col items-center justify-center gap-2 p-3 rounded-xl
                transition-all duration-200 border
                ${isActive 
                  ? 'bg-emerald-500/20 border-emerald-500/50 ring-2 ring-emerald-500 shadow-lg shadow-emerald-500/10' 
                  : 'bg-slate-800/30 border-white/5 hover:bg-white/5 hover:border-white/10'
                }
              `}
            >
              <img 
                src={type.icon} 
                alt="" 
                className="w-7 h-7 transition-all duration-200"
                style={{ 
                  filter: isActive 
                    ? 'invert(80%) sepia(60%) saturate(1000%) hue-rotate(100deg) brightness(100%) contrast(90%)' 
                    : 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)'
                }}
              />
              <span className={`text-xs font-medium transition-colors ${isActive ? 'text-emerald-400' : 'text-slate-400'}`}>
                {type.label}
              </span>
              
              {/* Active indicator dot */}
              {isActive && (
                <div className="absolute top-2 right-2 w-2 h-2 rounded-full bg-emerald-400 animate-pulse" />
              )}
            </button>
          );
        })}
      </div>

      {/* Custom Input (shown when 'Other' is selected) */}
      {showCustomInput && value === 'other' && (
        <form onSubmit={handleCustomSubmit} className="mt-3">
          <div className="flex gap-2">
            <input
              type="text"
              value={customType}
              onChange={(e) => setCustomType(e.target.value)}
              placeholder="Enter custom type..."
              className="flex-1 bg-black/50 border border-white/10 rounded-lg px-4 py-2.5 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-emerald-500/50 focus:ring-1 focus:ring-emerald-500/30 transition-all"
              autoFocus
            />
            <button
              type="submit"
              className="px-4 py-2 bg-emerald-500 text-white text-sm font-medium rounded-lg hover:bg-emerald-400 transition-colors"
            >
              Set
            </button>
          </div>
        </form>
      )}

      {/* Validation hint */}
      {!value && (
        <p className="text-xs text-amber-400/80 flex items-center gap-1.5 mt-2">
          <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
          </svg>
          Required to identify competitors
        </p>
      )}
    </div>
  );
}
</file>

<file path="src/components/Filters/index.js">
export { default as BusinessTypeSelector } from './BusinessTypeSelector';
export { default as ProximityFilters } from './ProximityFilters';
</file>

<file path="src/components/Filters/ProximityFilters.jsx">
/**
 * Proximity Filters Component
 * Step 2 in the user flow - Select what you want nearby
 */

import { useState } from 'react';
import { PROXIMITY_ICONS } from '../common/Icon';

// Proximity filter options with SVG icons
const PROXIMITY_FILTERS = [
  { id: 'near_metro', label: 'Metro', icon: PROXIMITY_ICONS.near_metro, popular: true },
  { id: 'near_bus', label: 'Bus Stop', icon: PROXIMITY_ICONS.near_bus, popular: false },
  { id: 'near_school', label: 'School', icon: PROXIMITY_ICONS.near_school, popular: false },
  { id: 'near_college', label: 'College', icon: PROXIMITY_ICONS.near_college, popular: true },
  { id: 'near_hospital', label: 'Hospital', icon: PROXIMITY_ICONS.near_hospital, popular: false },
  { id: 'near_mall', label: 'Mall', icon: PROXIMITY_ICONS.near_mall, popular: true },
  { id: 'near_office', label: 'Office/IT', icon: PROXIMITY_ICONS.near_office, popular: true },
  { id: 'near_residential', label: 'Residential', icon: PROXIMITY_ICONS.near_residential, popular: false },
  { id: 'near_temple', label: 'Temple', icon: PROXIMITY_ICONS.near_temple, popular: false },
  { id: 'near_park', label: 'Park', icon: PROXIMITY_ICONS.near_park, popular: false },
  { id: 'near_atm', label: 'ATM/Bank', icon: PROXIMITY_ICONS.near_atm, popular: false },
  { id: 'near_bar', label: 'Bar/Pub', icon: PROXIMITY_ICONS.near_bar, popular: false },
];

export default function ProximityFilters({ value = [], onChange, disabled }) {
  const [showAll, setShowAll] = useState(false);

  const toggleFilter = (filterId) => {
    if (disabled) return;
    
    const newFilters = value.includes(filterId)
      ? value.filter((f) => f !== filterId)
      : [...value, filterId];
    
    onChange(newFilters);
  };

  const selectPopular = () => {
    const popularFilters = PROXIMITY_FILTERS.filter((f) => f.popular).map((f) => f.id);
    onChange(popularFilters);
  };

  const clearAll = () => {
    onChange([]);
  };

  // Show only first 6 filters by default, or all if expanded
  const visibleFilters = showAll ? PROXIMITY_FILTERS : PROXIMITY_FILTERS.slice(0, 6);

  return (
    <div className="space-y-3 relative z-20">
      <div className="flex items-center justify-between">
        <label className="block text-sm font-medium text-slate-400">
          Step 2: What do you want nearby?
        </label>
        <span className="text-xs text-slate-500">
          {value.length} selected
        </span>
      </div>

      {/* Filter Chips Grid */}
      <div className={`grid grid-cols-3 gap-2 ${disabled ? 'opacity-50 pointer-events-none' : ''}`}>
        {visibleFilters.map((filter) => {
          const isActive = value.includes(filter.id);
          return (
            <button
              key={filter.id}
              type="button"
              onClick={() => toggleFilter(filter.id)}
              className={`
                chip flex flex-col items-center justify-center gap-1 py-2
                ${isActive ? 'chip-active' : 'chip-inactive'}
              `}
            >
              <img 
                src={filter.icon} 
                alt="" 
                className="w-5 h-5"
                style={{ filter: isActive 
                  ? 'invert(68%) sepia(51%) saturate(1016%) hue-rotate(359deg) brightness(101%) contrast(96%)' 
                  : 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)'
                }}
              />
              <span className="text-xs truncate w-full text-center">{filter.label}</span>
            </button>
          );
        })}
      </div>

      {/* Show More / Less Toggle */}
      {PROXIMITY_FILTERS.length > 6 && (
        <button
          type="button"
          onClick={() => setShowAll(!showAll)}
          className="text-xs text-slate-500 hover:text-slate-300 transition-colors"
        >
          {showAll ? ' Show less' : `Show ${PROXIMITY_FILTERS.length - 6} more `}
        </button>
      )}

      {/* Quick Actions */}
      <div className="flex gap-2">
        <button
          type="button"
          onClick={selectPopular}
          disabled={disabled}
          className="flex-1 text-xs py-1.5 px-2 rounded border border-surface-border text-slate-400 hover:text-primary-bright hover:border-primary-glow transition-colors disabled:opacity-50 flex items-center justify-center gap-1"
        >
          <svg className="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
          </svg>
          Select Popular
        </button>
        <button
          type="button"
          onClick={clearAll}
          disabled={disabled || value.length === 0}
          className="flex-1 text-xs py-1.5 px-2 rounded border border-surface-border text-slate-400 hover:text-destructive-bright hover:border-destructive-glow transition-colors disabled:opacity-50 flex items-center justify-center gap-1"
        >
          <svg className="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
          </svg>
          Clear All
        </button>
      </div>

      {/* Optional hint */}
      <p className="text-xs text-slate-500">
        Optional  Filters affect score calculation
      </p>
    </div>
  );
}
</file>

<file path="src/components/Layout/Header.jsx">
/**
 * Header Component - Floating Island Design
 * Glass-morphic Command Center aesthetic
 */

export default function Header({ isDarkMode, onToggleTheme }) {
  return (
    <header className="fixed top-4 left-1/2 -translate-x-1/2 w-[92%] max-w-6xl z-50">
      <div className={`backdrop-blur-xl ${isDarkMode ? 'bg-slate-900/80 border-white/10' : 'bg-white/80 border-slate-200'} border rounded-full px-4 py-2 flex items-center justify-between shadow-xl ${isDarkMode ? 'shadow-black/20' : 'shadow-slate-300/30'}`}>
        {/* Left: Logo & Brand */}
        <div className="flex items-center gap-2">
          {/* Logo Image */}
          <div className="w-8 h-8 flex items-center justify-center">
            <img 
              src="/hotspot-logo.png" 
              alt="Hotspot IQ" 
              className="w-8 h-8 object-contain"
              onError={(e) => {
                e.target.style.display = 'none';
                e.target.nextSibling.style.display = 'flex';
              }}
            />
            {/* Fallback gradient icon */}
            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-400 to-cyan-500 items-center justify-center hidden">
              <svg className="w-5 h-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
          </div>
          
          {/* Brand Text */}
          <div className="leading-tight">
            <h1 className="text-base font-bold tracking-tight">
              <span className="bg-gradient-to-r from-emerald-400 via-cyan-400 to-emerald-400 bg-clip-text text-transparent">
                Hotspot
              </span>
              <span className={isDarkMode ? 'text-white' : 'text-slate-800'}>IQ</span>
            </h1>
            <p className={`text-[9px] ${isDarkMode ? 'text-slate-500' : 'text-slate-400'} tracking-wider uppercase -mt-0.5`}>
              Location Intelligence
            </p>
          </div>
        </div>

        {/* Right: Navigation & Links */}
        <div className="flex items-center gap-3">
          {/* Nav Links */}
          <nav className="hidden md:flex items-center">
            <a href="#" className={`px-3 py-1.5 text-xs ${isDarkMode ? 'text-slate-400 hover:text-white hover:bg-white/5' : 'text-slate-500 hover:text-slate-800 hover:bg-slate-100'} rounded-full transition-all duration-200`}>
              Dashboard
            </a>
            <a href="#" className={`px-3 py-1.5 text-xs ${isDarkMode ? 'text-slate-400 hover:text-white hover:bg-white/5' : 'text-slate-500 hover:text-slate-800 hover:bg-slate-100'} rounded-full transition-all duration-200`}>
              Analytics
            </a>
            <a href="#" className={`px-3 py-1.5 text-xs ${isDarkMode ? 'text-slate-400 hover:text-white hover:bg-white/5' : 'text-slate-500 hover:text-slate-800 hover:bg-slate-100'} rounded-full transition-all duration-200`}>
              API Docs
            </a>
          </nav>

          {/* Divider */}
          <div className={`hidden md:block w-px h-5 ${isDarkMode ? 'bg-white/10' : 'bg-slate-200'}`} />

          {/* Powered By */}
          <div className="hidden sm:flex items-center gap-1.5 text-[11px]">
            <span className={isDarkMode ? 'text-slate-500' : 'text-slate-400'}>Powered by</span>
            <span className="text-emerald-500 font-semibold">LatLong.ai</span>
          </div>

          {/* Theme Toggle Button */}
          <button
            onClick={onToggleTheme}
            className={`w-8 h-8 flex items-center justify-center rounded-full ${isDarkMode ? 'bg-white/5 hover:bg-white/10 border-white/10 hover:border-white/20' : 'bg-slate-100 hover:bg-slate-200 border-slate-200 hover:border-slate-300'} border transition-all duration-200 group`}
            title={isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'}
          >
            {isDarkMode ? (
              // Sun icon for light mode
              <svg className="w-4 h-4 text-amber-400 group-hover:text-amber-300 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
              </svg>
            ) : (
              // Moon icon for dark mode
              <svg className="w-4 h-4 text-slate-500 group-hover:text-slate-700 transition-colors" fill="currentColor" viewBox="0 0 24 24">
                <path fillRule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clipRule="evenodd" />
              </svg>
            )}
          </button>

          {/* GitHub Link */}
          <a 
            href="https://github.com/Shubhojit-17/Hotspot-IQ" 
            target="_blank" 
            rel="noopener noreferrer"
            className={`w-7 h-7 flex items-center justify-center rounded-full ${isDarkMode ? 'bg-white/5 hover:bg-white/10 border-white/10 hover:border-white/20' : 'bg-slate-100 hover:bg-slate-200 border-slate-200 hover:border-slate-300'} border transition-all duration-200 group`}
          >
            <svg className={`w-4 h-4 ${isDarkMode ? 'text-slate-400 group-hover:text-white' : 'text-slate-500 group-hover:text-slate-800'} transition-colors`} fill="currentColor" viewBox="0 0 24 24">
              <path fillRule="evenodd" clipRule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0012 2z" />
            </svg>
          </a>
        </div>
      </div>
    </header>
  );
}
</file>

<file path="src/components/Layout/index.js">
export { default as Header } from './Header';
</file>

<file path="src/components/Map/HeatmapOverlay.jsx">
/**
 * Heatmap Overlay Component
 * Shows competition density as a heatmap overlay on the map
 * Red = High competition (avoid), Green = Low competition (opportunity)
 */

import { useEffect, useRef } from 'react';
import { useMap } from 'react-leaflet';
import L from 'leaflet';

/**
 * Generate heatmap data points based on competitors and landmarks
 * Creates a grid of points with intensity values
 */
function generateHeatmapGrid(center, competitors, landmarks, radius = 2500) {
  const gridSize = 20; // Number of grid cells in each direction
  const cellSize = (radius * 2) / gridSize;
  const points = [];
  
  // Convert radius from meters to degrees (approximate)
  const latDelta = radius / 111000; // 1 degree lat  111km
  const lngDelta = radius / (111000 * Math.cos(center.lat * Math.PI / 180));
  
  // Create grid
  for (let i = 0; i < gridSize; i++) {
    for (let j = 0; j < gridSize; j++) {
      const lat = center.lat - latDelta + (i / gridSize) * 2 * latDelta;
      const lng = center.lng - lngDelta + (j / gridSize) * 2 * lngDelta;
      
      // Calculate competition intensity at this point
      let competitorScore = 0;
      let landmarkScore = 0;
      
      // Higher score = more competitors nearby = RED
      competitors.forEach(comp => {
        if (comp.lat && comp.lng) {
          const dist = getDistance(lat, lng, comp.lat, comp.lng);
          if (dist < cellSize * 2) {
            competitorScore += Math.max(0, 1 - dist / (cellSize * 2));
          }
        }
      });
      
      // Landmarks add opportunity (reduce competition effect slightly)
      landmarks.forEach(lm => {
        if (lm.lat && lm.lng) {
          const dist = getDistance(lat, lng, lm.lat, lm.lng);
          if (dist < cellSize * 2) {
            landmarkScore += Math.max(0, 0.3 * (1 - dist / (cellSize * 2)));
          }
        }
      });
      
      // Net intensity: positive = competition (red), negative = opportunity (green)
      // Normalize to 0-1 range
      const intensity = Math.min(1, Math.max(0, competitorScore - landmarkScore * 0.5));
      
      points.push({
        lat,
        lng,
        intensity,
        hasCompetitors: competitorScore > 0,
      });
    }
  }
  
  return points;
}

/**
 * Calculate distance between two points in meters
 */
function getDistance(lat1, lng1, lat2, lng2) {
  const R = 6371000; // Earth's radius in meters
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = 
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
    Math.sin(dLng / 2) * Math.sin(dLng / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

/**
 * Get color based on intensity
 * Low intensity (0) = Green (opportunity)
 * High intensity (1) = Red (competition)
 */
function getHeatColor(intensity) {
  // Color gradient: Green -> Yellow -> Orange -> Red
  if (intensity < 0.25) {
    // Green to light green
    const t = intensity / 0.25;
    return {
      r: Math.round(34 + t * 100),
      g: Math.round(197 - t * 50),
      b: Math.round(94 - t * 50),
      a: 0.3 + t * 0.1
    };
  } else if (intensity < 0.5) {
    // Light green to yellow
    const t = (intensity - 0.25) / 0.25;
    return {
      r: Math.round(134 + t * 121),
      g: Math.round(147 + t * 53),
      b: Math.round(44 - t * 44),
      a: 0.4 + t * 0.1
    };
  } else if (intensity < 0.75) {
    // Yellow to orange
    const t = (intensity - 0.5) / 0.25;
    return {
      r: 255,
      g: Math.round(200 - t * 100),
      b: 0,
      a: 0.5 + t * 0.1
    };
  } else {
    // Orange to red
    const t = (intensity - 0.75) / 0.25;
    return {
      r: 255,
      g: Math.round(100 - t * 60),
      b: Math.round(t * 50),
      a: 0.6 + t * 0.15
    };
  }
}

export default function HeatmapOverlay({ 
  center, 
  competitors = [], 
  landmarks = [],
  radius = 2500,
  enabled = true 
}) {
  const map = useMap();
  const canvasRef = useRef(null);
  const overlayRef = useRef(null);

  useEffect(() => {
    if (!enabled || !center || !map) return;

    // Remove existing overlay
    if (overlayRef.current) {
      map.removeLayer(overlayRef.current);
    }

    // Generate heatmap points
    const points = generateHeatmapGrid(center, competitors, landmarks, radius);
    
    // If no competitors, don't show heatmap
    if (competitors.length === 0) return;

    // Calculate bounds
    const latDelta = radius / 111000;
    const lngDelta = radius / (111000 * Math.cos(center.lat * Math.PI / 180));
    const bounds = L.latLngBounds(
      [center.lat - latDelta, center.lng - lngDelta],
      [center.lat + latDelta, center.lng + lngDelta]
    );

    // Create canvas with higher resolution for smoother circle
    const canvas = document.createElement('canvas');
    const canvasSize = 400;
    canvas.width = canvasSize;
    canvas.height = canvasSize;
    const ctx = canvas.getContext('2d');

    // Define circular clipping region first
    const centerX = canvasSize / 2;
    const centerY = canvasSize / 2;
    const circleRadius = canvasSize / 2 - 2; // Slightly smaller for clean edge

    // Create circular clip path
    ctx.save();
    ctx.beginPath();
    ctx.arc(centerX, centerY, circleRadius, 0, Math.PI * 2);
    ctx.clip();

    // Draw heatmap cells within the circle
    const gridSize = 20;
    const cellWidth = canvasSize / gridSize;
    const cellHeight = canvasSize / gridSize;

    points.forEach((point, index) => {
      const i = Math.floor(index / gridSize);
      const j = index % gridSize;
      
      const x = j * cellWidth + cellWidth / 2;
      const y = (gridSize - 1 - i) * cellHeight + cellHeight / 2;
      
      // Check if point is within circle
      const distFromCenter = Math.sqrt(Math.pow(x - centerX, 2) + Math.pow(y - centerY, 2));
      if (distFromCenter > circleRadius) return;
      
      const color = getHeatColor(point.intensity);
      const cellRadius = cellWidth * 1.0;
      
      // Create radial gradient for smooth effect
      const gradient = ctx.createRadialGradient(x, y, 0, x, y, cellRadius);
      gradient.addColorStop(0, `rgba(${color.r}, ${color.g}, ${color.b}, ${color.a})`);
      gradient.addColorStop(1, `rgba(${color.r}, ${color.g}, ${color.b}, 0)`);
      
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(x, y, cellRadius, 0, Math.PI * 2);
      ctx.fill();
    });

    // Restore context (removes clip)
    ctx.restore();

    // Draw circle border
    ctx.strokeStyle = 'rgba(16, 185, 129, 0.4)';
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.arc(centerX, centerY, circleRadius, 0, Math.PI * 2);
    ctx.stroke();

    // Create image overlay
    const imageUrl = canvas.toDataURL();
    overlayRef.current = L.imageOverlay(imageUrl, bounds, {
      opacity: 0.7,
      interactive: false,
    });
    
    overlayRef.current.addTo(map);

    // Cleanup
    return () => {
      if (overlayRef.current) {
        map.removeLayer(overlayRef.current);
      }
    };
  }, [map, center, competitors, landmarks, radius, enabled]);

  return null;
}
</file>

<file path="src/components/Map/index.js">
export { default as MapView } from './MapView';
export { default as HeatmapOverlay } from './HeatmapOverlay';
</file>

<file path="src/components/Map/MapView.jsx">
/**
 * Map Container Component
 * The main map canvas using React-Leaflet
 */

import { useEffect, useRef, useState, useMemo } from 'react';
import { MapContainer, TileLayer, Marker, Popup, useMap, Circle } from 'react-leaflet';
import L from 'leaflet';
import HeatmapOverlay from './HeatmapOverlay';

// Fix for default marker icons in React-Leaflet
delete L.Icon.Default.prototype._getIconUrl;
L.Icon.Default.mergeOptions({
  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png',
  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
});

// =====================================================
// CONTEXTUAL VISIBILITY - Relevance Matrix
// =====================================================
// Maps business types to landmark categories with relevance scores (0.1 to 1.0)
// Higher score = more relevant for business success
const RELEVANCE_MATRIX = {
  cafe: {
    office: 0.95, school: 0.7, college: 0.9, university: 0.9, hospital: 0.5,
    mall: 0.8, metro_station: 0.9, bus_stop: 0.75, railway_station: 0.85,
    residential: 0.7, park: 0.8, temple: 0.4, bar: 0.85, restaurant: 0.6,
    hotel: 0.7, atm: 0.5, gym: 0.65, pharmacy: 0.3, default: 0.5
  },
  restaurant: {
    office: 0.95, school: 0.5, college: 0.85, university: 0.85, hospital: 0.6,
    mall: 0.85, metro_station: 0.8, bus_stop: 0.65, railway_station: 0.75,
    residential: 0.85, park: 0.6, temple: 0.65, bar: 0.9, restaurant: 0.4,
    hotel: 0.9, atm: 0.5, gym: 0.55, pharmacy: 0.3, default: 0.5
  },
  retail: {
    office: 0.7, school: 0.6, college: 0.75, university: 0.75, hospital: 0.5,
    mall: 0.95, metro_station: 0.9, bus_stop: 0.8, railway_station: 0.85,
    residential: 0.95, park: 0.5, temple: 0.6, bar: 0.4, restaurant: 0.6,
    hotel: 0.7, atm: 0.8, gym: 0.5, pharmacy: 0.6, default: 0.6
  },
  gym: {
    office: 0.9, school: 0.3, college: 0.85, university: 0.85, hospital: 0.4,
    mall: 0.7, metro_station: 0.75, bus_stop: 0.6, railway_station: 0.65,
    residential: 0.95, park: 0.85, temple: 0.2, bar: 0.3, restaurant: 0.5,
    hotel: 0.7, atm: 0.5, gym: 0.2, pharmacy: 0.6, default: 0.5
  },
  pharmacy: {
    office: 0.6, school: 0.7, college: 0.65, university: 0.65, hospital: 0.95,
    mall: 0.7, metro_station: 0.75, bus_stop: 0.7, railway_station: 0.7,
    residential: 0.95, park: 0.4, temple: 0.5, bar: 0.2, restaurant: 0.4,
    hotel: 0.6, atm: 0.6, gym: 0.5, pharmacy: 0.3, default: 0.5
  },
  salon: {
    office: 0.75, school: 0.3, college: 0.7, university: 0.7, hospital: 0.4,
    mall: 0.9, metro_station: 0.7, bus_stop: 0.6, railway_station: 0.65,
    residential: 0.95, park: 0.4, temple: 0.5, bar: 0.6, restaurant: 0.6,
    hotel: 0.8, atm: 0.5, gym: 0.7, pharmacy: 0.4, default: 0.5
  },
  electronics: {
    office: 0.85, school: 0.5, college: 0.9, university: 0.9, hospital: 0.4,
    mall: 0.95, metro_station: 0.85, bus_stop: 0.7, railway_station: 0.8,
    residential: 0.8, park: 0.3, temple: 0.3, bar: 0.3, restaurant: 0.5,
    hotel: 0.6, atm: 0.7, gym: 0.4, pharmacy: 0.3, default: 0.5
  },
  clothing: {
    office: 0.6, school: 0.5, college: 0.85, university: 0.85, hospital: 0.3,
    mall: 0.95, metro_station: 0.85, bus_stop: 0.7, railway_station: 0.8,
    residential: 0.85, park: 0.4, temple: 0.5, bar: 0.5, restaurant: 0.6,
    hotel: 0.7, atm: 0.7, gym: 0.5, pharmacy: 0.3, default: 0.5
  },
  bookstore: {
    office: 0.7, school: 0.95, college: 0.95, university: 0.95, hospital: 0.4,
    mall: 0.75, metro_station: 0.7, bus_stop: 0.6, railway_station: 0.7,
    residential: 0.7, park: 0.6, temple: 0.4, bar: 0.2, restaurant: 0.5,
    hotel: 0.5, atm: 0.5, gym: 0.3, pharmacy: 0.3, default: 0.5
  },
  other: {
    office: 0.6, school: 0.5, college: 0.5, university: 0.5, hospital: 0.5,
    mall: 0.7, metro_station: 0.7, bus_stop: 0.6, railway_station: 0.65,
    residential: 0.7, park: 0.5, temple: 0.5, bar: 0.5, restaurant: 0.5,
    hotel: 0.5, atm: 0.5, gym: 0.5, pharmacy: 0.5, default: 0.5
  }
};

// Get relevance score for a business type and landmark category
const getRelevanceScore = (businessType, landmarkCategory) => {
  const bt = businessType?.toLowerCase() || 'other';
  const lc = landmarkCategory?.toLowerCase().replace(/\s+/g, '_') || 'default';

  const businessScores = RELEVANCE_MATRIX[bt] || RELEVANCE_MATRIX['other'];
  return businessScores[lc] ?? businessScores['default'] ?? 0.5;
};

// Calculate marker style based on relevance
const getMarkerStyle = (businessType, landmarkCategory) => {
  const score = getRelevanceScore(businessType, landmarkCategory);

  // Opacity: 0.35 (low relevance) to 1.0 (high relevance)
  const opacity = 0.35 + (score * 0.65);

  // Scale: 0.7 (low relevance) to 1.15 (high relevance)
  const scale = 0.7 + (score * 0.45);

  // Size: 24px (low relevance) to 36px (high relevance)
  const size = Math.round(24 + (score * 12));

  // Z-index: 100 (low relevance) to 900 (high relevance)
  const zIndex = Math.round(100 + (score * 800));

  return { opacity, scale, size, zIndex, score };
};

// Landmark category to icon mapping
const LANDMARK_ICON_MAP = {
  metro_station: '/icons/metro.svg',
  metro: '/icons/metro.svg',
  bus_stop: '/icons/bus.svg',
  bus: '/icons/bus.svg',
  railway_station: '/icons/metro.svg',
  railway: '/icons/metro.svg',
  school: '/icons/school.svg',
  college: '/icons/college.svg',
  university: '/icons/college.svg',
  hospital: '/icons/hospital.svg',
  clinic: '/icons/hospital.svg',
  mall: '/icons/mall.svg',
  office: '/icons/office.svg',
  residential: '/icons/house.svg',
  temple: '/icons/temple.svg',
  church: '/icons/temple.svg',
  mosque: '/icons/temple.svg',
  park: '/icons/park.svg',
  atm: '/icons/bank.svg',
  bank: '/icons/bank.svg',
  bar: '/icons/bar.svg',
  pub: '/icons/bar.svg',
  restaurant: '/icons/restaurant.svg',
  cafe: '/icons/cafe.svg',
  hotel: '/icons/building.svg',
  pharmacy: '/icons/pharmacy.svg',
  gym: '/icons/gym.svg',
  supermarket: '/icons/mall.svg',
  default: '/icons/marker.svg',
};

// Custom marker icons with SVG - supports dynamic size/opacity for contextual visibility
// Size scaling is handled via CSS classes based on zoom level
const createCustomIcon = (color, iconPath, baseSize = 32, opacity = 1, zIndex = 500) => {
  const iconSize = baseSize;
  const innerIconSize = Math.round(baseSize * 0.5);

  return L.divIcon({
    className: 'custom-marker',
    html: `
      <div style="
        width: ${iconSize}px;
        height: ${iconSize}px;
        background: ${color};
        border: 2px solid white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        opacity: ${opacity};
        z-index: ${zIndex};
        position: relative;
      ">
        <div style="
          width: ${innerIconSize}px;
          height: ${innerIconSize}px;
          background-color: white;
          -webkit-mask: url('${iconPath}') center/contain no-repeat;
          mask: url('${iconPath}') center/contain no-repeat;
        "></div>
      </div>
    `,
    iconSize: [iconSize, iconSize],
    iconAnchor: [iconSize / 2, iconSize / 2],
    popupAnchor: [0, -iconSize / 2],
  });
};

// Cache for landmark icons - keyed by category + business type
const landmarkIconCache = {};

// Get landmark icon based on category with contextual visibility styling
const getLandmarkIcon = (category, businessType = null) => {
  const normalizedCategory = category?.toLowerCase().replace(/\s+/g, '_') || 'default';
  const bt = businessType?.toLowerCase() || 'other';
  const cacheKey = `${normalizedCategory}-${bt}`;

  // Return cached icon if available
  if (landmarkIconCache[cacheKey]) {
    return landmarkIconCache[cacheKey];
  }

  const iconPath = LANDMARK_ICON_MAP[normalizedCategory] || LANDMARK_ICON_MAP.default;

  // Get contextual visibility styling
  const style = getMarkerStyle(bt, normalizedCategory);

  // Create icon with contextual styling (CSS handles zoom scaling)
  const icon = createCustomIcon('#06b6d4', iconPath, style.size, style.opacity, style.zIndex);
  landmarkIconCache[cacheKey] = icon;
  return icon;
};

// Numbered recommended spot icon - HIGHLY DISTINCTIVE design
// These are the "best places to start business" markers - must stand out!
const createSpotIcon = (rank, color) => {
  // Much larger than other markers
  const size = 52;
  const fontSize = 18;
  
  // Bright, high-contrast colors for each rank
  const spotColors = {
    1: { bg: '#FFD700', text: '#000', glow: 'rgba(255, 215, 0, 0.8)', border: '#FFA500' },  // Gold
    2: { bg: '#C0C0C0', text: '#000', glow: 'rgba(192, 192, 192, 0.8)', border: '#A0A0A0' }, // Silver
    3: { bg: '#CD7F32', text: '#fff', glow: 'rgba(205, 127, 50, 0.8)', border: '#8B4513' },  // Bronze
    4: { bg: '#9333EA', text: '#fff', glow: 'rgba(147, 51, 234, 0.8)', border: '#7C3AED' },  // Purple
    5: { bg: '#EC4899', text: '#fff', glow: 'rgba(236, 72, 153, 0.8)', border: '#DB2777' },  // Pink
  };
  
  const colors = spotColors[rank] || spotColors[5];
  
  return L.divIcon({
    className: 'recommended-spot-marker',
    html: `
      <div class="spot-container" style="
        position: relative;
        width: ${size}px;
        height: ${size + 15}px;
      ">
        <!-- Pin pointer at bottom -->
        <div style="
          position: absolute;
          bottom: 0;
          left: 50%;
          transform: translateX(-50%);
          width: 0;
          height: 0;
          border-left: 10px solid transparent;
          border-right: 10px solid transparent;
          border-top: 15px solid ${colors.border};
          filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        "></div>
        
        <!-- Main circle with star icon -->
        <div style="
          position: absolute;
          top: 0;
          left: 0;
          width: ${size}px;
          height: ${size}px;
          background: linear-gradient(145deg, ${colors.bg}, ${colors.border});
          border: 4px solid white;
          border-radius: 50%;
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          box-shadow: 
            0 4px 15px ${colors.glow},
            0 0 30px ${colors.glow},
            inset 0 2px 4px rgba(255,255,255,0.4);
          animation: spot-pulse 1.5s ease-in-out infinite;
        ">
          <!-- Star icon -->
          <svg width="16" height="16" viewBox="0 0 24 24" fill="${colors.text}" style="margin-bottom: 1px;">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <!-- Rank number -->
          <span style="
            font-size: ${fontSize}px;
            font-weight: 900;
            color: ${colors.text};
            text-shadow: ${colors.text === '#000' ? 'none' : '0 1px 2px rgba(0,0,0,0.3)'};
            line-height: 1;
          ">${rank}</span>
        </div>
        
        <!-- Outer ring animation -->
        <div style="
          position: absolute;
          top: -6px;
          left: -6px;
          width: ${size + 12}px;
          height: ${size + 12}px;
          border: 2px solid ${colors.bg};
          border-radius: 50%;
          opacity: 0.6;
          animation: ring-pulse 1.5s ease-in-out infinite;
        "></div>
      </div>
      
      <style>
        @keyframes spot-pulse {
          0%, 100% { 
            transform: scale(1);
            box-shadow: 0 4px 15px ${colors.glow}, 0 0 30px ${colors.glow}, inset 0 2px 4px rgba(255,255,255,0.4);
          }
          50% { 
            transform: scale(1.05);
            box-shadow: 0 6px 25px ${colors.glow}, 0 0 50px ${colors.glow}, inset 0 2px 4px rgba(255,255,255,0.4);
          }
        }
        @keyframes ring-pulse {
          0%, 100% { 
            transform: scale(1);
            opacity: 0.6;
          }
          50% { 
            transform: scale(1.15);
            opacity: 0.2;
          }
        }
      </style>
    `,
    iconSize: [size, size + 15],
    iconAnchor: [size / 2, size + 15],
    popupAnchor: [0, -size - 10],
  });
};

// Create competitor icon (CSS handles zoom scaling)
const createCompetitorIcon = () => {
  return createCustomIcon('#f43f5e', '/icons/store.svg', 32, 1, 500);
};

// landmarkIcon is now dynamically created per category using getLandmarkIcon()

// Component to handle map view changes - only flies to location ONCE when center changes
function MapController({ center, zoom, hasFlown, setHasFlown }) {
  const map = useMap();

  useEffect(() => {
    // Only fly to location once when a NEW location is selected
    if (center && !hasFlown) {
      map.flyTo(center, zoom || 15, {
        duration: 1.5,
      });
      setHasFlown(true);
    }
  }, [center, zoom, map, hasFlown, setHasFlown]);

  return null;
}

// Component to track zoom level and update markers via CSS class
function ZoomTracker({ onZoomChange }) {
  const map = useMap();

  useEffect(() => {
    const handleZoom = () => {
      const zoom = Math.round(map.getZoom());
      onZoomChange(zoom);
      
      // Update CSS class on map container for zoom-based styling
      const container = map.getContainer();
      // Remove old zoom classes
      container.className = container.className.replace(/map-zoom-\d+/g, '').trim();
      // Add new zoom class
      container.classList.add(`map-zoom-${zoom}`);
    };

    // Set initial zoom
    handleZoom();

    map.on('zoomend', handleZoom);
    return () => map.off('zoomend', handleZoom);
  }, [map, onZoomChange]);

  return null;
}

// Component to handle click events
function MapClickHandler({ onClick }) {
  const map = useMap();

  useEffect(() => {
    if (!onClick) return;

    const handleClick = (e) => {
      onClick({
        lat: e.latlng.lat,
        lng: e.latlng.lng,
      });
    };

    map.on('click', handleClick);
    return () => map.off('click', handleClick);
  }, [map, onClick]);

  return null;
}

export default function MapView({
  selectedLocation,
  competitors = [],
  landmarks = [],
  recommendedSpots = [],
  isochrone = null,
  onMapClick,
  onSpotClick,
  center = [12.9716, 77.5946], // Default: Bangalore
  zoom = 13,
  showHeatmap = true,
  showLandmarks = true,
  showCompetitors = true,
  setShowLandmarks,
  setShowCompetitors,
  businessType = null, // For contextual visibility
  radius = null, // Radius in meters
  analysis = null, // For stats panel
  onOpenPanel, // Callback to open analysis panel
  isLoading = false, // Loading state
  isDarkMode = true, // Dark/Light mode toggle
}) {
  const mapRef = useRef(null);
  const [heatmapEnabled, setHeatmapEnabled] = useState(true);
  const [showSpots, setShowSpots] = useState(true);
  const [contextualVisibility, setContextualVisibility] = useState(true); // Toggle for contextual visibility
  const [currentZoom, setCurrentZoom] = useState(zoom); // Track current zoom level for dynamic marker sizing
  const [hasFlown, setHasFlown] = useState(false); // Track if we've flown to location (prevent repeated flying)
  const [lastLocationKey, setLastLocationKey] = useState(null); // Track which location we flew to

  // Reset hasFlown when location changes to a NEW location
  useEffect(() => {
    const locationKey = selectedLocation ? `${selectedLocation.lat}-${selectedLocation.lng}` : null;
    if (locationKey !== lastLocationKey) {
      setHasFlown(false);
      setLastLocationKey(locationKey);
    }
  }, [selectedLocation, lastLocationKey]);

  // Clear landmark icon cache when business type changes (for contextual visibility)
  // Note: Zoom scaling is now handled via CSS, so no need to clear on zoom change
  useEffect(() => {
    // Clear cache to force re-creation of icons with new business type styling
    Object.keys(landmarkIconCache).forEach(key => delete landmarkIconCache[key]);
  }, [businessType, contextualVisibility]);

  // Safely convert to arrays
  const competitorList = Array.isArray(competitors) ? competitors : [];
  const landmarkList = Array.isArray(landmarks) ? landmarks : [];
  const spotList = Array.isArray(recommendedSpots) ? recommendedSpots : [];

  // Spot colors by rank
  const getSpotColor = (rank) => {
    const colors = {
      1: '#10b981', // Emerald
      2: '#06b6d4', // Cyan
      3: '#3b82f6', // Blue
      4: '#8b5cf6', // Purple
      5: '#6b7280', // Gray
    };
    return colors[rank] || colors[5];
  };

  // Circle area style
  const circleStyle = {
    color: '#10b981',
    weight: 2,
    opacity: 0.8,
    fillColor: '#10b981',
    fillOpacity: 0.1,
  };

  // Calculate radius for the circular area (meters)
  // Use provided radius prop if available, otherwise fallback to defaults
  const areaRadius = radius || (selectedLocation?.is_major ? 2500 : 1500);

  return (
    <div className="absolute inset-0 z-0">
      <MapContainer
        ref={mapRef}
        center={center}
        zoom={zoom}
        className="w-full h-full"
        zoomControl={true}
        attributionControl={false}
      >
        {/* Tile layer - switches between dark and light mode */}
        <TileLayer
          key={isDarkMode ? 'dark' : 'light'}
          url={isDarkMode 
            ? "https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png"
            : "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png"
          }
          attribution='&copy; <a href="https://carto.com/">CARTO</a>'
        />

        {/* Map controllers */}
        <MapController
          center={selectedLocation && selectedLocation.lat != null && selectedLocation.lng != null
            ? [selectedLocation.lat, selectedLocation.lng]
            : null}
          zoom={15}
          hasFlown={hasFlown}
          setHasFlown={setHasFlown}
        />
        <MapClickHandler onClick={onMapClick} />
        <ZoomTracker onZoomChange={setCurrentZoom} />

        {/* Circular area selection - covers the entire selected area */}
        {selectedLocation && selectedLocation.lat != null && selectedLocation.lng != null && (
          <Circle
            center={[selectedLocation.lat, selectedLocation.lng]}
            radius={areaRadius}
            pathOptions={circleStyle}
          />
        )}

        {/* Competition Heatmap Overlay */}
        {selectedLocation && selectedLocation.lat != null && heatmapEnabled && showHeatmap && (
          <HeatmapOverlay
            center={{ lat: selectedLocation.lat, lng: selectedLocation.lng }}
            competitors={competitorList}
            landmarks={landmarkList}
            radius={areaRadius}
            enabled={heatmapEnabled}
          />
        )}

        {/* Recommended Spot markers - rendered LAST to be on top */}
        {showSpots && spotList
          .filter(s => s.lat != null && s.lng != null)
          .map((spot) => (
            <Marker
              key={`spot-${spot.rank}`}
              position={[spot.lat, spot.lng]}
              icon={createSpotIcon(spot.rank, getSpotColor(spot.rank))}
              zIndexOffset={1000 + (6 - spot.rank) * 100}
              eventHandlers={{
                click: () => onSpotClick && onSpotClick(spot)
              }}
            >
              <Popup>
                <div className="text-slate-900 min-w-[200px]">
                  <div className="flex items-center gap-2 mb-2">
                    <div className="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold" 
                         style={{ background: spot.rank === 1 ? '#FFD700' : spot.rank === 2 ? '#C0C0C0' : spot.rank === 3 ? '#CD7F32' : spot.rank === 4 ? '#9333EA' : '#EC4899' }}>
                      {spot.rank}
                    </div>
                    <div>
                      <span className="font-bold text-base">Best Location #{spot.rank}</span>
                      <p className="text-xs text-slate-500">Recommended for your business</p>
                    </div>
                  </div>
                  <p className="text-xs font-mono text-slate-500 mb-2">
                    {spot.lat.toFixed(6)}, {spot.lng.toFixed(6)}
                  </p>
                  <div className="flex items-center gap-2 mb-2">
                    <span className={`px-2 py-0.5 text-xs rounded-full font-medium ${spot.rating === 'Excellent' ? 'bg-emerald-100 text-emerald-700' :
                        spot.rating === 'Good' ? 'bg-cyan-100 text-cyan-700' :
                          spot.rating === 'Moderate' ? 'bg-amber-100 text-amber-700' :
                            'bg-orange-100 text-orange-700'
                      }`}>
                      {spot.rating}
                    </span>
                    <span className="text-xs text-slate-600">Score: {Math.round(spot.score)}</span>
                  </div>
                  <ul className="text-xs text-slate-600 space-y-0.5">
                    {spot.reasons?.slice(0, 2).map((reason, i) => (
                      <li key={i} className="flex items-start gap-1">
                        <svg className="w-3 h-3 text-emerald-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                          <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                        </svg>
                        <span>{reason}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              </Popup>
            </Marker>
          ))}

        {/* Competitor markers - only show those with coordinates */}
        {showCompetitors && competitorList
          .filter(c => c.lat != null && c.lng != null)
          .map((competitor, index) => (
            <Marker
              key={`competitor-${index}`}
              position={[competitor.lat, competitor.lng]}
              icon={createCompetitorIcon()}
            >
              <Popup>
                <div className="text-slate-900">
                  <p className="font-semibold">{competitor.name}</p>
                  <p className="text-xs text-slate-500">{competitor.category}</p>
                  {competitor.distance && (
                    <p className="text-xs text-rose-600 mt-1">
                      {competitor.distance}m away
                    </p>
                  )}
                </div>
              </Popup>
            </Marker>
          ))}

        {/* Landmark markers - only show those with coordinates */}
        {/* Uses contextual visibility to adjust opacity/size based on business relevance */}
        {showLandmarks && landmarkList
          .filter(l => l.lat != null && l.lng != null)
          .map((landmark, index) => {
            const relevance = getRelevanceScore(businessType, landmark.category);
            return (
              <Marker
              key={`landmark-${index}`}
              position={[landmark.lat, landmark.lng]}
              icon={getLandmarkIcon(landmark.category, contextualVisibility ? businessType : null)}
                zIndexOffset={contextualVisibility ? Math.round(relevance * 800) : 0}
              >
                <Popup>
                  <div className="text-slate-900">
                    <p className="font-semibold">{landmark.name}</p>
                    <p className="text-xs text-slate-500">{landmark.category}</p>
                    {contextualVisibility && businessType && (
                      <div className="mt-2 pt-2 border-t border-slate-200">
                        <div className="flex items-center gap-2">
                          <span className="text-xs text-slate-400">Relevance:</span>
                          <div className="flex-1 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                            <div
                              className={`h-full rounded-full ${relevance >= 0.8 ? 'bg-emerald-500' :
                                  relevance >= 0.6 ? 'bg-cyan-500' :
                                    relevance >= 0.4 ? 'bg-amber-500' :
                                      'bg-slate-400'
                                }`}
                              style={{ width: `${relevance * 100}%` }}
                            />
                          </div>
                          <span className={`text-xs font-medium ${relevance >= 0.8 ? 'text-emerald-600' :
                              relevance >= 0.6 ? 'text-cyan-600' :
                                relevance >= 0.4 ? 'text-amber-600' :
                                  'text-slate-500'
                            }`}>
                            {Math.round(relevance * 100)}%
                          </span>
                        </div>
                        <p className="text-[10px] text-slate-400 mt-1">
                          {relevance >= 0.8 ? 'High impact for your business' :
                            relevance >= 0.6 ? 'Moderate impact' :
                              relevance >= 0.4 ? 'Some relevance' :
                                'Low relevance for this business type'}
                        </p>
                      </div>
                    )}
                  </div>
                </Popup>
              </Marker>
            );
          })}
      </MapContainer>

      {/* Unified Bottom-Right Controls - Single Column Stack */}
      {selectedLocation && !isLoading && (
        <div className="absolute bottom-6 right-6 z-[1000] flex flex-col gap-3 w-[300px]">
          
          {/* Row 1: Quick Stats Panel */}
          {analysis && onOpenPanel && (
            <button
              onClick={onOpenPanel}
              className="w-full backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-4 hover:bg-slate-800/90 transition-all cursor-pointer group shadow-xl"
            >
              <div className="flex items-center gap-4">
                <div className="text-center">
                  <p className="text-3xl font-bold text-emerald-400">
                    {analysis.recommended_spots?.length || 0}
                  </p>
                  <p className="text-xs text-slate-500">Spots</p>
                </div>
                <div className="w-px h-10 bg-white/10" />
                <div className="text-left text-sm">
                  <p className="text-slate-300">
                    <span className="text-rose-400 font-semibold">{analysis.competitors?.count || 0}</span> competitors
                  </p>
                  <p className="text-slate-300">
                    <span className="text-cyan-400 font-semibold">{analysis.landmarks?.total || 0}</span> landmarks
                  </p>
                </div>
                <div className="text-slate-500 group-hover:text-white group-hover:translate-x-0.5 transition-all ml-auto">
                  <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                  </svg>
                </div>
              </div>
            </button>
          )}

          {/* Row 2: Landmarks & Competitors Toggle */}
          {setShowLandmarks && setShowCompetitors && (
            <div className="backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-2 flex gap-2 shadow-xl">
              <button
                onClick={() => setShowLandmarks(!showLandmarks)}
                className={`flex-1 px-4 py-2.5 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${showLandmarks
                  ? 'bg-cyan-500 text-white shadow-md shadow-cyan-500/25'
                  : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-slate-300'
                  }`}
              >
                <img src="/icons/building.svg" alt="" className="w-4 h-4"
                  style={{ filter: showLandmarks ? 'brightness(0) invert(1)' : 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }}
                />
                <span>Landmarks</span>
              </button>
              <button
                onClick={() => setShowCompetitors(!showCompetitors)}
                className={`flex-1 px-4 py-2.5 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${showCompetitors
                  ? 'bg-rose-500 text-white shadow-md shadow-rose-500/25'
                  : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-slate-300'
                  }`}
              >
                <img src="/icons/store.svg" alt="" className="w-4 h-4"
                  style={{ filter: showCompetitors ? 'brightness(0) invert(1)' : 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }}
                />
                <span>Competitors</span>
              </button>
            </div>
          )}

          {/* Row 3: Heatmap, Spots, Smart View Toggle */}
          {competitorList.length > 0 && (
            <div className="backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-2 flex flex-wrap gap-2 shadow-xl">
              <button
                onClick={() => setHeatmapEnabled(!heatmapEnabled)}
                className={`flex-1 min-w-[80px] px-3 py-2.5 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${heatmapEnabled
                    ? 'bg-amber-500 text-white shadow-md shadow-amber-500/25'
                    : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-slate-300'
                  }`}
              >
                <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7" />
                </svg>
                <span>Heatmap</span>
              </button>
              {spotList.length > 0 && (
                <button
                  onClick={() => setShowSpots(!showSpots)}
                  className={`flex-1 min-w-[80px] px-3 py-2.5 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${showSpots
                      ? 'bg-emerald-500 text-white shadow-md shadow-emerald-500/25'
                      : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-slate-300'
                    }`}
                >
                  <img src="/icons/star.svg" alt="" className="w-4 h-4" style={{ filter: showSpots ? 'brightness(0) invert(1)' : 'invert(70%) sepia(10%) saturate(200%) hue-rotate(180deg) brightness(90%) contrast(85%)' }} />
                  <span>{spotList.length} Spots</span>
                </button>
              )}
              {businessType && landmarkList.length > 0 && (
                <button
                  onClick={() => setContextualVisibility(!contextualVisibility)}
                  className={`flex-1 min-w-[80px] px-3 py-2.5 rounded-xl text-sm font-medium transition-all flex items-center justify-center gap-2 ${contextualVisibility
                      ? 'bg-violet-500 text-white shadow-md shadow-violet-500/25'
                      : 'bg-slate-800/50 text-slate-400 hover:bg-slate-700/50 hover:text-slate-300'
                    }`}
                  title="Adjusts landmark visibility based on relevance to your business type"
                >
                  <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  <span>Smart</span>
                </button>
              )}
            </div>
          )}

          {/* Row 4: Heatmap Legend */}
          {heatmapEnabled && competitorList.length > 0 && (
            <div className="backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-4 shadow-xl">
              <p className="text-sm font-medium text-slate-300 mb-2">Competition Density</p>
              <div className="flex items-center gap-1">
                <div className="w-5 h-5 rounded-md" style={{ background: 'rgb(34, 197, 94)' }} />
                <div className="w-5 h-5 rounded-md" style={{ background: 'rgb(134, 197, 94)' }} />
                <div className="w-5 h-5 rounded-md" style={{ background: 'rgb(255, 200, 0)' }} />
                <div className="w-5 h-5 rounded-md" style={{ background: 'rgb(255, 150, 0)' }} />
                <div className="w-5 h-5 rounded-md" style={{ background: 'rgb(255, 80, 50)' }} />
              </div>
              <div className="flex justify-between text-xs text-slate-500 mt-2">
                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-emerald-500"></span>Low</span>
                <span className="flex items-center gap-1"><span className="w-2 h-2 rounded-full bg-rose-500"></span>High</span>
              </div>
            </div>
          )}

          {/* Row 5: Smart View Legend */}
          {contextualVisibility && businessType && landmarkList.length > 0 && (
            <div className="backdrop-blur-xl bg-slate-900/90 border border-white/10 rounded-2xl p-4 shadow-xl">
              <p className="text-sm font-medium text-slate-300 mb-3 flex items-center gap-2">
                <svg className="w-4 h-4 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Smart: {businessType}
              </p>
              <div className="space-y-2">
                <div className="flex items-center gap-2 text-sm">
                  <div className="w-5 h-5 rounded-full bg-cyan-500 opacity-100 flex items-center justify-center">
                    <span className="text-white text-xs"></span>
                  </div>
                  <span className="text-slate-400">High relevance</span>
                </div>
                <div className="flex items-center gap-2 text-sm">
                  <div className="w-4 h-4 rounded-full bg-cyan-500 opacity-50 flex items-center justify-center">
                    <span className="text-white text-[8px]"></span>
                  </div>
                  <span className="text-slate-400">Low relevance</span>
                </div>
              </div>
            </div>
          )}
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/Search/index.js">
export { default as SearchBar } from './SearchBar';
</file>

<file path="src/components/Search/SearchBar.jsx">
/**
 * Search Bar Component - Spotlight Style
 * Glass-morphic search with glowing border effect
 */

import { useState, useEffect, useRef, useCallback } from 'react';
import { searchLocations } from '../../services/api';

// Debounce hook
function useDebounce(value, delay) {
  const [debouncedValue, setDebouncedValue] = useState(value);

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => clearTimeout(handler);
  }, [value, delay]);

  return debouncedValue;
}

export default function SearchBar({ onLocationSelect, disabled, selectedLocation }) {
  const [query, setQuery] = useState('');
  const [suggestions, setSuggestions] = useState([]);
  const [isOpen, setIsOpen] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [selectedIndex, setSelectedIndex] = useState(-1);
  
  const inputRef = useRef(null);
  const dropdownRef = useRef(null);
  
  const debouncedQuery = useDebounce(query, 300);

  // Update query when selectedLocation changes (e.g., from map click)
  useEffect(() => {
    if (selectedLocation?.name) {
      setQuery(selectedLocation.name);
      setIsOpen(false);
      setSuggestions([]);
    }
  }, [selectedLocation]);

  // Fetch suggestions when debounced query changes
  useEffect(() => {
    const fetchSuggestions = async () => {
      if (debouncedQuery.length < 2) {
        setSuggestions([]);
        setIsOpen(false);
        return;
      }

      setIsLoading(true);
      try {
        const results = await searchLocations(debouncedQuery);
        setSuggestions(results);
        setIsOpen(results.length > 0);
        setSelectedIndex(-1);
      } catch (error) {
        console.error('Search error:', error);
        setSuggestions([]);
      } finally {
        setIsLoading(false);
      }
    };

    fetchSuggestions();
  }, [debouncedQuery]);

  // Close dropdown when clicking outside
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (
        dropdownRef.current &&
        !dropdownRef.current.contains(event.target) &&
        !inputRef.current.contains(event.target)
      ) {
        setIsOpen(false);
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, []);

  // Handle keyboard navigation
  const handleKeyDown = (e) => {
    if (e.key === 'Escape') {
      setIsOpen(false);
      setSelectedIndex(-1);
      return;
    }

    if (e.key === 'Enter') {
      e.preventDefault();
      // If we have a selected suggestion, use it
      if (isOpen && selectedIndex >= 0 && suggestions[selectedIndex]) {
        handleSelect(suggestions[selectedIndex]);
      } 
      // If we have suggestions but none selected, use the first one
      else if (isOpen && suggestions.length > 0) {
        handleSelect(suggestions[0]);
      }
      // If no suggestions but we have a query, create a manual location
      else if (query.trim().length >= 2) {
        // Trigger a fresh search or use the query as-is
        onLocationSelect({
          name: query.trim(),
          lat: null,
          lng: null,
          needsGeocode: true,
        });
      }
      return;
    }

    if (!isOpen) return;

    switch (e.key) {
      case 'ArrowDown':
        e.preventDefault();
        setSelectedIndex((prev) => 
          prev < suggestions.length - 1 ? prev + 1 : prev
        );
        break;
      case 'ArrowUp':
        e.preventDefault();
        setSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));
        break;
      default:
        break;
    }
  };

  const handleSelect = (location) => {
    setQuery(location.name);
    setIsOpen(false);
    setSuggestions([]);
    onLocationSelect(location);
  };

  const handleClear = () => {
    setQuery('');
    setSuggestions([]);
    setIsOpen(false);
    inputRef.current?.focus();
  };

  return (
    <div className="space-y-2 relative z-10">
      <label className="text-sm font-medium text-slate-300">
        Which area to analyze?
      </label>
      <p className="text-xs text-slate-500 -mt-1">
        Search for a locality, neighborhood, or city
      </p>

      <div className="relative">
        {/* Spotlight Search Input */}
        <div className={`relative group ${isOpen ? 'ring-2 ring-emerald-500/50' : ''} rounded-xl transition-all duration-300`}>
          {/* Glow effect on focus */}
          <div className={`absolute -inset-0.5 bg-gradient-to-r from-emerald-500/20 via-cyan-500/20 to-emerald-500/20 rounded-xl blur-sm transition-opacity duration-300 ${isOpen ? 'opacity-100' : 'opacity-0 group-hover:opacity-50'}`} />
          
          <div className="relative flex items-center">
            <span className="absolute left-4 text-slate-500">
              <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </span>
            <input
              ref={inputRef}
              type="text"
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              onKeyDown={handleKeyDown}
              onFocus={() => suggestions.length > 0 && setIsOpen(true)}
              disabled={disabled}
              placeholder="Koramangala, Indiranagar, Bandra..."
              className={`
                w-full bg-black/50 border border-white/10 rounded-xl pl-12 pr-12 py-3.5
                text-white placeholder-slate-500 text-sm
                focus:outline-none focus:border-emerald-500/50 focus:bg-black/70
                transition-all duration-200
                ${disabled ? 'opacity-50 cursor-not-allowed' : ''}
              `}
            />
            
            {/* Loading / Clear Button */}
            <div className="absolute right-4">
              {isLoading ? (
                <svg className="w-5 h-5 text-emerald-400 animate-spin" fill="none" viewBox="0 0 24 24">
                  <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4" />
                  <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
                </svg>
              ) : query ? (
                <button
                  type="button"
                  onClick={handleClear}
                  className="text-slate-500 hover:text-white transition-colors p-1"
                >
                  <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                </button>
              ) : null}
            </div>
          </div>
        </div>

        {/* Suggestions Dropdown */}
        {isOpen && suggestions.length > 0 && (
          <div
            ref={dropdownRef}
            className="absolute z-50 w-full mt-2 backdrop-blur-xl bg-slate-900/95 border border-white/10 rounded-xl shadow-2xl overflow-hidden animate-slide-in-up"
          >
            <ul className="max-h-64 overflow-y-auto">
              {suggestions.map((suggestion, index) => (
                <li key={suggestion.place_id || index}>
                  <button
                    type="button"
                    onClick={() => handleSelect(suggestion)}
                    className={`
                      w-full flex items-start gap-3 px-4 py-3 text-left
                      transition-colors duration-150
                      ${selectedIndex === index ? 'bg-emerald-500/10' : 'hover:bg-white/5'}
                    `}
                  >
                    {/* Show different icon for major areas vs others */}
                    <span className="mt-0.5">
                      {suggestion.is_major ? (
                        <svg className="w-4 h-4 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                      ) : suggestion.is_area ? (
                        <svg className="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                        </svg>
                      ) : (
                        <svg className="w-4 h-4 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                      )}
                    </span>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2">
                        <p className="text-slate-200 truncate">{suggestion.name}</p>
                        {suggestion.is_major && (
                          <span className="text-[10px] bg-emerald-500/20 text-emerald-400 px-1.5 py-0.5 rounded-full whitespace-nowrap border border-emerald-500/20">
                            Major Area
                          </span>
                        )}
                      </div>
                      {suggestion.is_area && !suggestion.is_major && (
                        <p className="text-xs text-slate-500 mt-0.5">Locality</p>
                      )}
                    </div>
                  </button>
                </li>
              ))}
            </ul>
          </div>
        )}

        {/* No results message */}
        {isOpen && query.length >= 2 && suggestions.length === 0 && !isLoading && (
          <div className="absolute z-50 w-full mt-2 backdrop-blur-xl bg-slate-900/95 border border-white/10 rounded-xl shadow-2xl p-4 text-center text-slate-400 animate-fade-in">
            <p>No locations found for "{query}"</p>
            <p className="text-xs mt-1 text-slate-500">Try a different area name or click on the map</p>
          </div>
        )}
      </div>

      {/* Hints */}
      {disabled ? (
        <p className="text-xs text-amber-400/80 flex items-center gap-1.5 mt-2">
          <svg className="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clipRule="evenodd" />
          </svg>
          Select a business type first
        </p>
      ) : (
        <p className="text-xs text-slate-500 flex items-center gap-1.5 mt-2">
          <svg className="w-3.5 h-3.5 text-emerald-400" fill="currentColor" viewBox="0 0 20 20">
            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
          </svg>
          You can also click anywhere on the map to select a location
        </p>
      )}
    </div>
  );
}
</file>

<file path="src/hooks/index.js">
export { default as useAnalysis } from './useAnalysis';
export { default as useLocation } from './useLocation';
export { default as useFilters } from './useFilters';
</file>

<file path="src/hooks/useAnalysis.js">
/**
 * useAnalysis Hook
 * Manages location analysis state and API calls with progressive loading
 */

import { useState, useCallback } from 'react';
import { analyzeLocation, getIsochrone, getDigipin } from '../services/api';

/**
 * Helper to normalize landmarks from API response
 * API returns: { list: [...], by_category: {...}, total: N }
 * We need: [{ name, category, lat, lng }, ...]
 */
function normalizeAllLandmarks(landmarksData) {
  if (!landmarksData) return [];

  // If it's already an array, return it
  if (Array.isArray(landmarksData)) return landmarksData;

  // Check for 'list' property first (our API structure)
  if (Array.isArray(landmarksData.list)) {
    return landmarksData.list;
  }

  // If it has by_category with arrays, flatten all categories into one array
  if (landmarksData.by_category && typeof landmarksData.by_category === 'object') {
    const allLandmarks = [];
    Object.entries(landmarksData.by_category).forEach(([category, items]) => {
      if (Array.isArray(items)) {
        items.forEach(item => {
          allLandmarks.push({
            ...item,
            category: category,
          });
        });
      }
    });
    if (allLandmarks.length > 0) return allLandmarks;
  }

  return [];
}

export default function useAnalysis() {
  const [analysis, setAnalysis] = useState(null);
  const [isochrone, setIsochrone] = useState(null);
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState(null);

  // Progressive loading status
  const [loadingStatus, setLoadingStatus] = useState({
    step: '',
    message: '',
    progress: 0,
    details: []
  });

  const updateStatus = (step, message, progress, detail = null) => {
    setLoadingStatus(prev => ({
      step,
      message,
      progress,
      details: detail ? [...prev.details, detail] : prev.details
    }));
  };

  const analyze = useCallback(async (location, businessType, filters, radius = 1000) => {
    if (!location || !businessType) {
      setError('Location and business type are required');
      return { success: false, isValidationError: false };
    }

    // Validate that we have coordinates
    if (location.lat == null || location.lng == null) {
      setError('Location coordinates are missing. Please select a different location.');
      return { success: false, isValidationError: false };
    }

    // Clear previous analysis data immediately (clears markers)
    setAnalysis(null);
    setIsochrone(null);
    setError(null);

    setIsLoading(true);
    setLoadingStatus({ step: 'init', message: 'Starting analysis...', progress: 0, details: [] });

    try {
      // Determine isochrone radius based on whether it's a major area
      const isMajorArea = location.is_major || false;
      // Use provided radius (converted to km) or fallback to defaults
      const isochroneRadius = radius ? (radius / 1000) : (isMajorArea ? 2.5 : 1.5);

      // Step 1: Initialize & Validate Location
      updateStatus('validation', 'Checking location validity...', 10, ' Location validated');
      await new Promise(r => setTimeout(r, 300)); // Brief delay for UI feedback

      // Step 2: Fetch isochrone (area boundary)
      updateStatus('boundary', 'Drawing search boundary...', 20);
      let isochroneData = null;
      try {
        isochroneData = await getIsochrone(location.lat, location.lng, isochroneRadius);
        updateStatus('boundary', 'Area boundary ready', 25, ' Area boundary loaded');
      } catch (err) {
        console.warn('Isochrone fetch failed:', err);
        updateStatus('boundary', 'Using circular boundary', 25, ' Using default circular area');
      }

      // Step 3: Run main analysis (includes validation + competitors + landmarks)
      updateStatus('analysis', 'Searching for businesses & landmarks...', 35);

      const analysisData = await analyzeLocation(
        location.lat,
        location.lng,
        businessType,
        filters,
        isMajorArea,
        radius
      );

      // Extract counts for status
      const competitorCount = analysisData.competitors?.count || 0;
      const nearbyList = analysisData.competitors?.nearby || [];
      const landmarkCount = analysisData.landmarks?.total || 0;
      const landmarkCategories = Object.keys(analysisData.landmarks?.by_category || {}).length;

      // Update with competitor results
      updateStatus('competitors', `Found ${competitorCount} competitors`, 55,
        ` ${competitorCount} ${businessType}${competitorCount !== 1 ? 's' : ''} found nearby`);

      await new Promise(r => setTimeout(r, 400));

      // Update with landmark results  
      updateStatus('landmarks', `Identified ${landmarkCount} landmarks`, 70,
        ` ${landmarkCount} landmarks in ${landmarkCategories} categories`);

      await new Promise(r => setTimeout(r, 300));

      // Step 4: Get DIGIPIN (optional)
      updateStatus('digipin', 'Retrieving location code...', 80);
      let digipin = null;
      try {
        const digipinData = await getDigipin(location.lat, location.lng);
        digipin = digipinData?.digipin;
        if (digipin) {
          updateStatus('digipin', 'DIGIPIN retrieved', 85, ` DIGIPIN: ${digipin.substring(0, 10)}...`);
        } else {
          updateStatus('digipin', 'DIGIPIN not available', 85, ' Location code retrieved');
        }
      } catch {
        updateStatus('digipin', 'DIGIPIN skipped', 85, ' Location code skipped');
      }

      await new Promise(r => setTimeout(r, 200));

      // Step 5: Find recommended spots
      const spotsCount = analysisData.recommended_spots?.length || 0;
      updateStatus('spots', `Analyzing ${spotsCount} optimal locations...`, 95,
        ` ${spotsCount} recommended spot${spotsCount !== 1 ? 's' : ''} identified`);
      await new Promise(r => setTimeout(r, 200));

      // Log raw response for debugging
      console.log(' Raw API Response:', JSON.stringify(analysisData, null, 2));

      // Normalize the API response to match frontend expectations
      const normalizedAnalysis = {
        // Recommended spots (new feature)
        recommended_spots: analysisData.recommended_spots || [],
        // Extract competitors from nested structure
        competitors: {
          count: analysisData.competitors?.count || 0,
          nearby: Array.isArray(analysisData.competitors?.nearby)
            ? analysisData.competitors.nearby
            : []
        },
        // Extract landmarks
        landmarks: {
          total: analysisData.landmarks?.total || 0,
          list: normalizeAllLandmarks(analysisData.landmarks),
          by_category: analysisData.landmarks?.by_category || {}
        },
        // Additional data
        footfall_proxy: analysisData.footfall_proxy || 'medium',
        location: location,
        digipin: digipin || analysisData.location?.digipin || '',
        address: analysisData.location?.address || {},
        business_type: analysisData.business_type || businessType,
      };

      // Log normalized data for debugging
      console.log(' Normalized Analysis:', {
        recommended_spots: normalizedAnalysis.recommended_spots,
        competitors: normalizedAnalysis.competitors,
        landmarks: normalizedAnalysis.landmarks
      });

      // Complete! - Show summary
      const summaryMsg = `${competitorCount} competitors, ${landmarkCount} landmarks, ${spotsCount} spots`;
      updateStatus('complete', summaryMsg, 100);

      setAnalysis(normalizedAnalysis);
      setIsochrone(isochroneData);

      return { success: true, isValidationError: false };
    } catch (err) {
      console.error('Analysis error:', err);

      // Check if this is a validation error (location invalid)
      const isValidationError = err.isValidationError || false;
      const errorMessage = err.message || 'Failed to analyze location';

      setError(errorMessage);
      setLoadingStatus(prev => ({
        ...prev,
        step: 'error',
        message: ` ${errorMessage}`,
        progress: 0
      }));

      // Keep analysis and isochrone null (no markers on map)
      setAnalysis(null);
      setIsochrone(null);

      return {
        success: false,
        isValidationError,
        errorType: err.errorType,
        errorMessage
      };
    } finally {
      setIsLoading(false);
    }
  }, []);

  const clearAnalysis = useCallback(() => {
    setAnalysis(null);
    setIsochrone(null);
    setError(null);
    setLoadingStatus({ step: '', message: '', progress: 0, details: [] });
  }, []);

  return {
    analysis,
    isochrone,
    isLoading,
    error,
    loadingStatus,
    analyze,
    clearAnalysis,
  };
}
</file>

<file path="src/hooks/useFilters.js">
/**
 * useFilters Hook
 * Manages business type and proximity filter selections
 */

import { useState, useCallback, useMemo } from 'react';

// Popular filter presets
const POPULAR_FILTERS = ['metro', 'mall', 'office', 'college'];

export default function useFilters() {
  const [businessType, setBusinessType] = useState(null);
  const [proximityFilters, setProximityFilters] = useState([]);

  // Toggle a single proximity filter
  const toggleFilter = useCallback((filterId) => {
    setProximityFilters((prev) => {
      if (prev.includes(filterId)) {
        return prev.filter((f) => f !== filterId);
      }
      return [...prev, filterId];
    });
  }, []);

  // Select multiple filters at once
  const selectFilters = useCallback((filterIds) => {
    setProximityFilters(filterIds);
  }, []);

  // Select popular filters preset
  const selectPopularFilters = useCallback(() => {
    setProximityFilters(POPULAR_FILTERS);
  }, []);

  // Clear all proximity filters
  const clearFilters = useCallback(() => {
    setProximityFilters([]);
  }, []);

  // Clear everything (business type + filters)
  const clearAll = useCallback(() => {
    setBusinessType(null);
    setProximityFilters([]);
  }, []);

  // Check if a filter is selected
  const isFilterSelected = useCallback(
    (filterId) => proximityFilters.includes(filterId),
    [proximityFilters]
  );

  // Check if ready to analyze
  const canAnalyze = useMemo(() => {
    return businessType !== null;
  }, [businessType]);

  // Get filter summary for display
  const filterSummary = useMemo(() => {
    if (proximityFilters.length === 0) return 'No preferences set';
    if (proximityFilters.length === 1) return '1 preference';
    return `${proximityFilters.length} preferences`;
  }, [proximityFilters]);

  return {
    // State
    businessType,
    proximityFilters,
    canAnalyze,
    filterSummary,
    
    // Business Type Actions
    setBusinessType,
    
    // Proximity Filter Actions
    toggleFilter,
    selectFilters,
    selectPopularFilters,
    clearFilters,
    isFilterSelected,
    
    // Reset
    clearAll,
  };
}
</file>

<file path="src/hooks/useLocation.js">
/**
 * useLocation Hook
 * Manages selected location state
 */

import { useState, useCallback } from 'react';
import { searchLocations, geocodeLocation } from '../services/api';

export default function useLocation() {
  const [selectedLocation, setSelectedLocation] = useState(null);
  const [searchResults, setSearchResults] = useState([]);
  const [isSearching, setIsSearching] = useState(false);
  const [isGeocoding, setIsGeocoding] = useState(false);
  const [searchError, setSearchError] = useState(null);

  const search = useCallback(async (query) => {
    if (!query || query.length < 2) {
      setSearchResults([]);
      return;
    }

    setIsSearching(true);
    setSearchError(null);

    try {
      const results = await searchLocations(query);
      setSearchResults(results);
    } catch (error) {
      console.error('Search error:', error);
      setSearchError(error.message || 'Failed to search locations');
      setSearchResults([]);
    } finally {
      setIsSearching(false);
    }
  }, []);

  const selectLocation = useCallback(async (location) => {
    // If location already has coordinates, use it directly
    if (location.lat && location.lng) {
      setSelectedLocation(location);
      setSearchResults([]);
      return;
    }
    
    // Otherwise, geocode the location name to get coordinates
    setIsGeocoding(true);
    setSearchError(null);
    
    try {
      const geocoded = await geocodeLocation(location.name);
      setSelectedLocation({
        name: location.name,
        lat: geocoded.lat,
        lng: geocoded.lng,
        address: geocoded.address,
        geoid: location.geoid
      });
      setSearchResults([]);
    } catch (error) {
      console.error('Geocode error:', error);
      setSearchError('Could not find coordinates for this location');
      // Still set the location but without coordinates
      setSelectedLocation({
        ...location,
        lat: null,
        lng: null,
        needsGeocode: true
      });
    } finally {
      setIsGeocoding(false);
    }
  }, []);

  const selectFromCoords = useCallback((lat, lng, name = null) => {
    setSelectedLocation({
      lat,
      lng,
      name: name || `${lat.toFixed(4)}, ${lng.toFixed(4)}`,
    });
  }, []);

  const clearLocation = useCallback(() => {
    setSelectedLocation(null);
    setSearchResults([]);
    setSearchError(null);
  }, []);

  return {
    // State
    selectedLocation,
    searchResults,
    isSearching,
    isGeocoding,
    searchError,
    
    // Actions
    search,
    selectLocation,
    selectFromCoords,
    clearLocation,
  };
}
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Custom Glassmorphism Utilities */
@layer components {
  .glass-panel {
    @apply bg-surface-primary backdrop-blur-[12px] border border-surface-border rounded-2xl shadow-glass;
  }

  .glass-card {
    @apply bg-surface-secondary backdrop-blur-[12px] border border-surface-border rounded-xl shadow-glass;
  }

  .glass-input {
    @apply bg-canvas-base border border-surface-border rounded-lg px-4 py-3 text-slate-50 placeholder-slate-500 focus:outline-none focus:border-primary-glow focus:shadow-glow-primary transition-all duration-200;
  }

  .btn-primary {
    @apply bg-primary-glow text-canvas-deep font-semibold px-6 py-3 rounded-lg hover:bg-primary-bright active:scale-[0.98] transition-all duration-200 shadow-glow-primary disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none;
  }

  .btn-ghost {
    @apply bg-transparent border border-surface-border text-slate-300 font-medium px-4 py-2 rounded-lg hover:bg-surface-elevated hover:text-slate-50 transition-all duration-200;
  }

  .chip {
    @apply px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-200 cursor-pointer select-none;
  }

  .chip-inactive {
    @apply bg-transparent border border-surface-border text-slate-500 hover:border-slate-500 hover:text-slate-400;
  }

  .chip-active {
    @apply bg-primary-soft border border-primary-glow text-primary-bright shadow-glow-primary;
  }

  .score-high {
    @apply bg-primary-soft border border-primary-glow text-primary-bright;
  }

  .score-medium {
    @apply bg-warning-soft border border-warning-glow text-warning-glow;
  }

  .score-low {
    @apply bg-destructive-soft border border-destructive-glow text-destructive-bright;
  }
}

/* Leaflet Map Dark Theme Overrides */
.leaflet-container {
  background: #020617;
  font-family: 'Inter', sans-serif;
}

.leaflet-control-zoom {
  border: 1px solid rgba(255, 255, 255, 0.08) !important;
  background: rgba(15, 23, 42, 0.9) !important;
  backdrop-filter: blur(12px);
}

.leaflet-control-zoom a {
  background: transparent !important;
  color: #cbd5e1 !important;
  border-bottom: 1px solid rgba(255, 255, 255, 0.08) !important;
}

.leaflet-control-zoom a:hover {
  background: rgba(51, 65, 85, 0.6) !important;
  color: #f8fafc !important;
}

.leaflet-popup-content-wrapper {
  background: rgba(15, 23, 42, 0.95);
  color: #f8fafc;
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 12px;
  backdrop-filter: blur(12px);
}

.leaflet-popup-tip {
  background: rgba(15, 23, 42, 0.95);
  border: 1px solid rgba(255, 255, 255, 0.08);
}

/* Custom Scrollbar */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  background: rgba(15, 23, 42, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb {
  background: rgba(100, 116, 139, 0.5);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: rgba(100, 116, 139, 0.7);
}

/* Animations */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.skeleton {
  background: linear-gradient(
    90deg,
    rgba(51, 65, 85, 0.3) 25%,
    rgba(51, 65, 85, 0.5) 50%,
    rgba(51, 65, 85, 0.3) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s infinite;
}

/* Pulse Ring Animation for Map Marker */
@keyframes pulseRing {
  0% {
    transform: scale(1);
    opacity: 0.8;
  }
  100% {
    transform: scale(2.5);
    opacity: 0;
  }
}

.marker-pulse-ring {
  animation: pulseRing 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

/* Slide-in animation for dropdowns and panels */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(8px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(100%);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.animate-slide-in-up {
  animation: slideInUp 0.2s ease-out;
}

.animate-slide-in-right {
  animation: slideInRight 0.3s ease-out;
}

.animate-fade-in {
  animation: fadeIn 0.2s ease-out;
}

.animate-fadeIn {
  animation: fadeIn 0.3s ease-out forwards;
}

.animate-slideIn {
  animation: slideIn 0.3s ease-out forwards;
}

/* Toast slide down animation */
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translate(-50%, -100%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, 0);
  }
}

.animate-slide-down {
  animation: slideDown 0.3s ease-out forwards;
}

/* Custom marker styles */
.custom-marker {
  background: transparent !important;
  border: none !important;
}

/* Recommended spot markers - ALWAYS visible and distinct */
.recommended-spot-marker {
  background: transparent !important;
  border: none !important;
  z-index: 9999 !important;
}

/* Recommended spots should NOT scale down as much - stay prominent */
.map-zoom-7 .recommended-spot-marker > div,
.map-zoom-8 .recommended-spot-marker > div {
  transform: scale(0.6) !important;
}

.map-zoom-9 .recommended-spot-marker > div,
.map-zoom-10 .recommended-spot-marker > div {
  transform: scale(0.7) !important;
}

.map-zoom-11 .recommended-spot-marker > div,
.map-zoom-12 .recommended-spot-marker > div {
  transform: scale(0.8) !important;
}

.map-zoom-13 .recommended-spot-marker > div,
.map-zoom-14 .recommended-spot-marker > div,
.map-zoom-15 .recommended-spot-marker > div,
.map-zoom-16 .recommended-spot-marker > div,
.map-zoom-17 .recommended-spot-marker > div,
.map-zoom-18 .recommended-spot-marker > div,
.map-zoom-19 .recommended-spot-marker > div,
.map-zoom-20 .recommended-spot-marker > div {
  transform: scale(1) !important;
}

/* Dynamic marker sizing based on zoom level */
/* Range: 10% (min) to 80% (max) for regular markers */
.leaflet-marker-icon {
  transition: transform 0.15s ease-out;
}

/* Zoom-based marker scaling using CSS classes */
/* Very zoomed out - minimum 10% size */
.map-zoom-7 .custom-marker > div,
.map-zoom-8 .custom-marker > div {
  transform: scale(0.1) !important;
}

.map-zoom-9 .custom-marker > div {
  transform: scale(0.15) !important;
}

.map-zoom-10 .custom-marker > div {
  transform: scale(0.2) !important;
}

.map-zoom-11 .custom-marker > div {
  transform: scale(0.3) !important;
}

.map-zoom-12 .custom-marker > div {
  transform: scale(0.4) !important;
}

.map-zoom-13 .custom-marker > div {
  transform: scale(0.5) !important;
}

.map-zoom-14 .custom-marker > div {
  transform: scale(0.6) !important;
}

.map-zoom-15 .custom-marker > div {
  transform: scale(0.7) !important;
}

/* Max size capped at 80% - zoom 16 and above */
.map-zoom-16 .custom-marker > div,
.map-zoom-17 .custom-marker > div,
.map-zoom-18 .custom-marker > div,
.map-zoom-19 .custom-marker > div,
.map-zoom-20 .custom-marker > div {
  transform: scale(0.8) !important;
}

/* ============================================== */
/* LIGHT MODE STYLES                              */
/* ============================================== */

/* Base light mode - when 'dark' class is NOT on html */
:root:not(.dark) {
  --canvas-deep: #f8fafc;
  --canvas-base: #f1f5f9;
  --surface-primary: rgba(255, 255, 255, 0.9);
  --surface-secondary: rgba(248, 250, 252, 0.9);
  --surface-border: rgba(0, 0, 0, 0.1);
  --text-primary: #0f172a;
  --text-secondary: #475569;
  --text-muted: #64748b;
}

/* Dark mode variables */
.dark {
  --canvas-deep: #020617;
  --canvas-base: #0f172a;
  --surface-primary: rgba(15, 23, 42, 0.8);
  --surface-secondary: rgba(30, 41, 59, 0.7);
  --surface-border: rgba(255, 255, 255, 0.08);
  --text-primary: #f8fafc;
  --text-secondary: #cbd5e1;
  --text-muted: #64748b;
}

/* Light mode glass panels */
:root:not(.dark) .glass-panel {
  background: rgba(255, 255, 255, 0.85) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

:root:not(.dark) .glass-card {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.08) !important;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

/* Light mode inputs */
:root:not(.dark) .glass-input {
  background: rgba(255, 255, 255, 0.95) !important;
  border-color: rgba(0, 0, 0, 0.15) !important;
  color: #0f172a !important;
}

:root:not(.dark) .glass-input::placeholder {
  color: #94a3b8 !important;
}

:root:not(.dark) .glass-input:focus {
  border-color: #10b981 !important;
  box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2) !important;
}

/* Light mode buttons */
:root:not(.dark) .btn-ghost {
  border-color: rgba(0, 0, 0, 0.15) !important;
  color: #334155 !important;
}

:root:not(.dark) .btn-ghost:hover {
  background: rgba(0, 0, 0, 0.05) !important;
  color: #0f172a !important;
}

/* Light mode chips */
:root:not(.dark) .chip-inactive {
  border-color: rgba(0, 0, 0, 0.15) !important;
  color: #64748b !important;
}

:root:not(.dark) .chip-inactive:hover {
  border-color: #94a3b8 !important;
  color: #475569 !important;
}

/* Light mode leaflet map controls */
:root:not(.dark) .leaflet-container {
  background: #f1f5f9;
}

:root:not(.dark) .leaflet-control-zoom {
  border: 1px solid rgba(0, 0, 0, 0.1) !important;
  background: rgba(255, 255, 255, 0.95) !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

:root:not(.dark) .leaflet-control-zoom a {
  background: transparent !important;
  color: #334155 !important;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
}

:root:not(.dark) .leaflet-control-zoom a:hover {
  background: rgba(0, 0, 0, 0.05) !important;
  color: #0f172a !important;
}

:root:not(.dark) .leaflet-popup-content-wrapper {
  background: rgba(255, 255, 255, 0.98);
  color: #0f172a;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

:root:not(.dark) .leaflet-popup-tip {
  background: rgba(255, 255, 255, 0.98);
  border: 1px solid rgba(0, 0, 0, 0.1);
}

/* Light mode scrollbar */
:root:not(.dark) ::-webkit-scrollbar-track {
  background: rgba(241, 245, 249, 0.8);
}

:root:not(.dark) ::-webkit-scrollbar-thumb {
  background: rgba(148, 163, 184, 0.5);
}

:root:not(.dark) ::-webkit-scrollbar-thumb:hover {
  background: rgba(148, 163, 184, 0.7);
}

/* Light mode skeleton loading */
:root:not(.dark) .skeleton {
  background: linear-gradient(
    90deg,
    rgba(226, 232, 240, 0.5) 25%,
    rgba(226, 232, 240, 0.8) 50%,
    rgba(226, 232, 240, 0.5) 75%
  );
  background-size: 200% 100%;
}

/* Light mode text colors - override common text utilities */
:root:not(.dark) .text-slate-50,
:root:not(.dark) .text-slate-100 {
  color: #0f172a !important;
}

:root:not(.dark) .text-slate-200,
:root:not(.dark) .text-slate-300 {
  color: #334155 !important;
}

:root:not(.dark) .text-slate-400,
:root:not(.dark) .text-slate-500 {
  color: #64748b !important;
}

/* Light mode background overrides for common patterns */
:root:not(.dark) .bg-canvas-deep {
  background-color: #f8fafc !important;
}

:root:not(.dark) .bg-canvas-base {
  background-color: #f1f5f9 !important;
}

:root:not(.dark) .bg-surface-primary {
  background-color: rgba(255, 255, 255, 0.9) !important;
}

:root:not(.dark) .bg-surface-secondary {
  background-color: rgba(248, 250, 252, 0.9) !important;
}

:root:not(.dark) .bg-surface-elevated {
  background-color: rgba(241, 245, 249, 0.9) !important;
}

/* Light mode border overrides */
:root:not(.dark) .border-surface-border {
  border-color: rgba(0, 0, 0, 0.1) !important;
}

:root:not(.dark) .border-slate-700,
:root:not(.dark) .border-slate-800 {
  border-color: rgba(0, 0, 0, 0.1) !important;
}

/* Light mode gradient backgrounds */
:root:not(.dark) .bg-gradient-to-b.from-slate-900 {
  background: linear-gradient(to bottom, #f1f5f9, #f8fafc) !important;
}

:root:not(.dark) .bg-gradient-to-r.from-slate-800 {
  background: linear-gradient(to right, #f8fafc, #f1f5f9) !important;
}

/* Light mode divide colors */
:root:not(.dark) .divide-slate-700 > :not([hidden]) ~ :not([hidden]),
:root:not(.dark) .divide-slate-800 > :not([hidden]) ~ :not([hidden]) {
  border-color: rgba(0, 0, 0, 0.08) !important;
}

/* Light mode ring colors */
:root:not(.dark) .ring-slate-800,
:root:not(.dark) .ring-surface-border {
  --tw-ring-color: rgba(0, 0, 0, 0.1) !important;
}

/* Light mode hover states */
:root:not(.dark) .hover\:bg-surface-elevated:hover {
  background-color: rgba(226, 232, 240, 0.8) !important;
}

:root:not(.dark) .hover\:bg-slate-800:hover {
  background-color: rgba(226, 232, 240, 0.6) !important;
}

/* Light mode focus states */
:root:not(.dark) .focus\:border-primary-glow:focus {
  border-color: #10b981 !important;
}

/* Score cards stay consistent */
:root:not(.dark) .score-high {
  background: rgba(16, 185, 129, 0.15) !important;
}

:root:not(.dark) .score-medium {
  background: rgba(245, 158, 11, 0.15) !important;
}

:root:not(.dark) .score-low {
  background: rgba(244, 63, 94, 0.15) !important;
}

/* ============================================== */
/* SIDEBAR & PANEL LIGHT MODE OVERRIDES           */
/* ============================================== */

/* Left sidebar panel - backdrop blur with light background */
:root:not(.dark) .backdrop-blur-xl.bg-slate-900\/80 {
  background: rgba(255, 255, 255, 0.9) !important;
  border-color: rgba(0, 0, 0, 0.1) !important;
}

/* Right sidebar/floating panels */
:root:not(.dark) .backdrop-blur-md.bg-slate-900\/90,
:root:not(.dark) .backdrop-blur-lg.bg-slate-900\/90 {
  background: rgba(255, 255, 255, 0.95) !important;
  border-color: rgba(0, 0, 0, 0.1) !important;
}

/* Panel borders */
:root:not(.dark) .border-white\/10,
:root:not(.dark) .border-white\/5 {
  border-color: rgba(0, 0, 0, 0.08) !important;
}

/* Text color overrides for panels */
:root:not(.dark) .text-white {
  color: #0f172a !important;
}

:root:not(.dark) .text-white\/80,
:root:not(.dark) .text-white\/70,
:root:not(.dark) .text-white\/60 {
  color: #334155 !important;
}

:root:not(.dark) .text-white\/50,
:root:not(.dark) .text-white\/40 {
  color: #64748b !important;
}

/* Slider track */
:root:not(.dark) .bg-slate-700\/50 {
  background: rgba(203, 213, 225, 0.6) !important;
}

:root:not(.dark) .bg-slate-700 {
  background: #cbd5e1 !important;
}

:root:not(.dark) .bg-slate-700\/30 {
  background: rgba(203, 213, 225, 0.4) !important;
}

/* Background overlays */
:root:not(.dark) .bg-slate-900\/50,
:root:not(.dark) .bg-slate-900\/60,
:root:not(.dark) .bg-slate-900\/70,
:root:not(.dark) .bg-slate-900\/80,
:root:not(.dark) .bg-slate-900\/90 {
  background: rgba(255, 255, 255, 0.9) !important;
}

:root:not(.dark) .bg-slate-800,
:root:not(.dark) .bg-slate-800\/50,
:root:not(.dark) .bg-slate-800\/60,
:root:not(.dark) .bg-slate-800\/70,
:root:not(.dark) .bg-slate-800\/80 {
  background: rgba(241, 245, 249, 0.9) !important;
}

/* Panel shadows for light mode */
:root:not(.dark) .shadow-2xl.shadow-black\/30 {
  box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15) !important;
}

/* Business type selector cards */
:root:not(.dark) .bg-slate-800\/30 {
  background: rgba(241, 245, 249, 0.7) !important;
}

:root:not(.dark) .hover\:bg-slate-800\/50:hover {
  background: rgba(226, 232, 240, 0.8) !important;
}

/* Active/selected states */
:root:not(.dark) .bg-emerald-500\/10 {
  background: rgba(16, 185, 129, 0.15) !important;
}

:root:not(.dark) .border-emerald-500\/20 {
  border-color: rgba(16, 185, 129, 0.3) !important;
}

/* Floating stats panel (bottom right) */
:root:not(.dark) .bg-gradient-to-br.from-slate-800\/95 {
  background: linear-gradient(to bottom right, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95)) !important;
}

/* Score display backgrounds */
:root:not(.dark) .bg-slate-900\/80 {
  background: rgba(255, 255, 255, 0.9) !important;
}

/* Ring and circle backgrounds */
:root:not(.dark) .text-slate-700 {
  color: #cbd5e1 !important;
}

/* Preserve emerald/primary colors in light mode */
:root:not(.dark) .text-emerald-400,
:root:not(.dark) .text-emerald-500 {
  color: #059669 !important;
}

:root:not(.dark) .text-cyan-400,
:root:not(.dark) .text-cyan-500 {
  color: #0891b2 !important;
}

/* Toggle buttons and switches */
:root:not(.dark) .bg-slate-600,
:root:not(.dark) .bg-slate-600\/50 {
  background: #94a3b8 !important;
}

:root:not(.dark) .hover\:bg-slate-700:hover {
  background: #cbd5e1 !important;
}

/* Mini stat cards */
:root:not(.dark) .bg-slate-800\/40 {
  background: rgba(241, 245, 249, 0.8) !important;
}

/* Analysis panel header */
:root:not(.dark) .from-slate-800 {
  background: linear-gradient(to right, #f8fafc, #f1f5f9) !important;
}

/* Dividers */
:root:not(.dark) .bg-slate-700\/50 {
  background: rgba(203, 213, 225, 0.5) !important;
}

/* Competitor/Landmark toggle buttons */
:root:not(.dark) .bg-cyan-500\/20 {
  background: rgba(6, 182, 212, 0.15) !important;
}

:root:not(.dark) .bg-orange-500\/20 {
  background: rgba(249, 115, 22, 0.15) !important;
}

:root:not(.dark) .border-cyan-500\/30 {
  border-color: rgba(6, 182, 212, 0.3) !important;
}

:root:not(.dark) .border-orange-500\/30 {
  border-color: rgba(249, 115, 22, 0.3) !important;
}

/* Input placeholder in light mode */
:root:not(.dark) input::placeholder,
:root:not(.dark) textarea::placeholder {
  color: #94a3b8 !important;
}

/* Range slider thumb */
:root:not(.dark) input[type="range"] {
  background: rgba(203, 213, 225, 0.6) !important;
}

/* Loading skeleton pulse */
:root:not(.dark) .animate-pulse {
  background-color: rgba(203, 213, 225, 0.5) !important;
}

/* Fix for accent colored text that should stay vibrant */
:root:not(.dark) .text-amber-400,
:root:not(.dark) .text-amber-500 {
  color: #d97706 !important;
}

:root:not(.dark) .text-rose-400,
:root:not(.dark) .text-rose-500 {
  color: #e11d48 !important;
}

:root:not(.dark) .text-violet-400,
:root:not(.dark) .text-violet-500 {
  color: #7c3aed !important;
}

/* Keep primary button text white */
:root:not(.dark) .bg-gradient-to-r.from-emerald-500 .text-white,
:root:not(.dark) .bg-emerald-500 .text-white,
:root:not(.dark) button.bg-gradient-to-r {
  color: white !important;
}

/* Button with gradient should keep white text */
:root:not(.dark) .from-emerald-500.to-cyan-500 {
  color: white !important;
}

/* Search input specific overrides */
:root:not(.dark) .bg-black\/50 {
  background: rgba(255, 255, 255, 0.95) !important;
}

:root:not(.dark) .bg-black\/70 {
  background: rgba(255, 255, 255, 0.98) !important;
}

:root:not(.dark) input.text-white {
  color: #0f172a !important;
}

/* Search dropdown */
:root:not(.dark) .bg-slate-900\/95 {
  background: rgba(255, 255, 255, 0.98) !important;
}

/* Dropdown items hover */
:root:not(.dark) .hover\:bg-slate-800\/50:hover {
  background: rgba(226, 232, 240, 0.7) !important;
}

:root:not(.dark) .bg-emerald-500\/10 {
  background: rgba(16, 185, 129, 0.12) !important;
}

/* Floating stats panel specific */
:root:not(.dark) .rounded-2xl.backdrop-blur-md {
  background: rgba(255, 255, 255, 0.95) !important;
}

/* Mini badges/pills */
:root:not(.dark) .bg-slate-700\/60 {
  background: rgba(203, 213, 225, 0.6) !important;
}

:root:not(.dark) .bg-slate-700\/40 {
  background: rgba(203, 213, 225, 0.4) !important;
}

/* Right panel specific styles */
:root:not(.dark) .space-y-2 .text-xs.text-slate-500 {
  color: #64748b !important;
}

:root:not(.dark) .space-y-1 .text-xs.text-slate-500 {
  color: #64748b !important;
}

/* Ensure all form inputs are readable */
:root:not(.dark) input[type="text"],
:root:not(.dark) input[type="search"] {
  color: #0f172a !important;
}

/* Map overlay controls */
:root:not(.dark) .bg-slate-800\/90 {
  background: rgba(255, 255, 255, 0.95) !important;
}

:root:not(.dark) .bg-slate-900 {
  background: #f8fafc !important;
}

/* Chip/tag active states */
:root:not(.dark) .bg-emerald-500\/20 {
  background: rgba(16, 185, 129, 0.18) !important;
}

:root:not(.dark) .bg-cyan-500\/10 {
  background: rgba(6, 182, 212, 0.12) !important;
}

:root:not(.dark) .bg-orange-500\/10 {
  background: rgba(249, 115, 22, 0.12) !important;
}

/* Dashboard cards text */
:root:not(.dark) .font-semibold.text-white {
  color: #0f172a !important;
}

:root:not(.dark) .font-medium.text-white {
  color: #1e293b !important;
}

/* Stats numbers should be dark */
:root:not(.dark) .text-2xl.font-bold.text-white,
:root:not(.dark) .text-3xl.font-bold.text-white,
:root:not(.dark) .text-xl.font-bold.text-white {
  color: #0f172a !important;
}

/* Keep primary colored text vibrant */
:root:not(.dark) .text-primary-glow,
:root:not(.dark) .text-primary-bright {
  color: #059669 !important;
}

/* Fix floating panel in bottom right */
:root:not(.dark) .fixed.bottom-6.right-6 .backdrop-blur-md {
  background: rgba(255, 255, 255, 0.95) !important;
  border-color: rgba(0, 0, 0, 0.1) !important;
}

/* Business type selector inactive cards */
:root:not(.dark) .border-white\/5 {
  border-color: rgba(0, 0, 0, 0.08) !important;
}

:root:not(.dark) .hover\:bg-white\/5:hover {
  background: rgba(0, 0, 0, 0.03) !important;
}

:root:not(.dark) .hover\:border-white\/10:hover {
  border-color: rgba(0, 0, 0, 0.12) !important;
}

/* Placeholder text */
:root:not(.dark) .placeholder-slate-500::placeholder {
  color: #94a3b8 !important;
}

/* Right panel toggle buttons container */
:root:not(.dark) .bg-slate-800\/60 {
  background: rgba(241, 245, 249, 0.8) !important;
}

/* Bottom right stats - ensure dark text */
:root:not(.dark) .text-lg.font-bold {
  color: #0f172a !important;
}

:root:not(.dark) .text-sm.font-semibold {
  color: #1e293b !important;
}

/* Legend/key colors - keep them visible */
:root:not(.dark) .bg-emerald-400,
:root:not(.dark) .bg-emerald-500 {
  background-color: #10b981 !important;
}

:root:not(.dark) .bg-amber-400,
:root:not(.dark) .bg-amber-500 {
  background-color: #f59e0b !important;
}

:root:not(.dark) .bg-rose-400,
:root:not(.dark) .bg-rose-500 {
  background-color: #f43f5e !important;
}

/* Make sure analyze button keeps white text */
:root:not(.dark) button.bg-gradient-to-r.from-emerald-500.to-cyan-500,
:root:not(.dark) .bg-gradient-to-r.from-emerald-500.to-cyan-500 button {
  color: white !important;
}

/* Generic white text in buttons should be preserved for colored backgrounds */
:root:not(.dark) .bg-emerald-500 .text-white,
:root:not(.dark) .bg-cyan-500 .text-white,
:root:not(.dark) .bg-gradient-to-r .text-white {
  color: white !important;
}

/* Fix the analyze button specifically */
:root:not(.dark) button[class*="from-emerald-500"][class*="to-cyan-500"] {
  color: white !important;
}
</file>

<file path="src/main.jsx">
import React from 'react'
import ReactDOM from 'react-dom/client'
import App from './App.jsx'
import './index.css'
import 'leaflet/dist/leaflet.css'

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
)
</file>

<file path="src/services/api.js">
/**
 * Hotspot IQ - API Service Layer
 * Handles all communication with the Flask backend
 */

import axios from 'axios';

// Create axios instance with base configuration
const api = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:5001/api',
  timeout: 120000, // 2 minutes to handle longer analysis calls
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor for logging
api.interceptors.request.use(
  (config) => {
    console.log(` API Request: ${config.method?.toUpperCase()} ${config.url}`);
    return config;
  },
  (error) => {
    console.error('API Request Error:', error);
    return Promise.reject(error);
  }
);

// Response interceptor for error handling
api.interceptors.response.use(
  (response) => {
    return response;
  },
  (error) => {
    console.error('API Response Error:', error.response?.data || error.message);
    return Promise.reject(error);
  }
);

/**
 * Search for locations using autocomplete
 * @param {string} query - Search term
 * @returns {Promise<Array>} Location suggestions
 */
export const searchLocations = async (query) => {
  if (!query || query.length < 2) return [];

  try {
    const response = await api.get('/autocomplete', { params: { query, limit: 10 } });
    const suggestions = response.data.suggestions || [];

    // LatLong autocomplete returns { name, geoid } without coordinates
    // We need to geocode to get coordinates when user selects a location
    return suggestions.map(s => ({
      name: s.name,
      place_id: s.place_id || s.geoid?.toString() || s.name,
      geoid: s.geoid,
      // lat/lng may be null from autocomplete - will be geocoded on selection
      lat: s.lat,
      lng: s.lng
    }));
  } catch (error) {
    console.error('Search error:', error);
    throw error;
  }
};

/**
 * Geocode a location name to get coordinates
 * @param {string} address - Location name/address
 * @returns {Promise<Object>} Location with coordinates
 */
export const geocodeLocation = async (address) => {
  try {
    const response = await api.get('/geocode', { params: { address } });
    return response.data;
  } catch (error) {
    console.error('Geocode error:', error);
    throw error;
  }
};

/**
 * Reverse geocode coordinates to get address
 * @param {number} lat - Latitude
 * @param {number} lng - Longitude
 * @param {number} radius - Optional radius in meters for area-based geocoding
 * @returns {Promise<Object>} Address details { address, area_name, pincode, landmark }
 */
export const reverseGeocode = async (lat, lng, radius = 0) => {
  try {
    const params = { lat, lng };
    if (radius > 0) {
      params.radius = radius;
    }
    const response = await api.get('/reverse-geocode', { params });
    return response.data;
  } catch (error) {
    console.error('Reverse geocode error:', error);
    throw error;
  }
};

/**
 * Analyze a location for business potential
 * @param {number} lat - Latitude
 * @param {number} lng - Longitude
 * @param {string} businessType - Type of business
 * @param {Array<string>} filters - Proximity filters
 * @param {boolean} isMajor - Whether this is a major area (larger radius)
 * @returns {Promise<Object>} Analysis results
 * @throws {Error} With validation error message if location is invalid
 */
export const analyzeLocation = async (lat, lng, businessType, filters = [], isMajor = false, radius = 1000) => {
  try {
    const response = await api.post('/analyze', {
      lat,
      lng,
      business_type: businessType,
      filters,
      is_major: isMajor,
      radius,
    });
    return response.data;
  } catch (error) {
    console.error('Analysis error:', error);

    // Extract validation error from backend response
    if (error.response?.data) {
      const data = error.response.data;

      // Check if this is a validation failure
      if (data.validation_failed || data.error_type) {
        const validationError = new Error(data.error || data.message || 'Location validation failed');
        validationError.isValidationError = true;
        validationError.errorType = data.error_type;
        throw validationError;
      }

      // Regular error with message from backend
      if (data.error) {
        throw new Error(data.error);
      }
    }

    throw error;
  }
};

/**
 * Get isochrone polygon for reachability
 * @param {number} lat - Latitude
 * @param {number} lng - Longitude
 * @param {number} distanceKm - Distance in kilometers (default: 1.0)
 * @returns {Promise<Object>} GeoJSON Feature
 * 
 * Also supports legacy mode/time format which is converted on backend:
 * @param {string} mode - Travel mode (walk, bike, car) - optional
 * @param {number} timeMinutes - Travel time in minutes - optional
 */
export const getIsochrone = async (lat, lng, distanceKmOrMode = 1.0, timeMinutes = null) => {
  try {
    let payload = { lat, lng };

    // Support both new format (distance_km) and legacy (mode + time_minutes)
    if (typeof distanceKmOrMode === 'number' && timeMinutes === null) {
      payload.distance_km = distanceKmOrMode;
    } else if (typeof distanceKmOrMode === 'string') {
      payload.mode = distanceKmOrMode;
      payload.time_minutes = timeMinutes || 15;
    } else {
      payload.distance_km = distanceKmOrMode;
    }

    const response = await api.post('/isochrone', payload);
    return response.data;
  } catch (error) {
    console.error('Isochrone error:', error);
    throw error;
  }
};

/**
 * Get Digipin for a location
 * @param {number} lat - Latitude
 * @param {number} lng - Longitude
 * @returns {Promise<Object>} Digipin data
 */
export const getDigipin = async (lat, lng) => {
  try {
    const response = await api.get('/digipin', { params: { lat, lng } });
    return response.data;
  } catch (error) {
    console.error('Digipin error:', error);
    throw error;
  }
};

/**
 * Send chat message to AI assistant
 * @param {string} message - User message
 * @param {Object} context - Location context
 * @returns {Promise<Object>} AI response
 */
export const chat = async (message, context = {}) => {
  try {
    const response = await api.post('/chat', {
      message,
      context,
    });
    return response.data;
  } catch (error) {
    console.error('Chat error:', error);
    throw error;
  }
};

/**
 * Check supply chain feasibility
 * @param {number} storeLat - Store latitude
 * @param {number} storeLng - Store longitude
 * @param {number} warehouseLat - Warehouse latitude
 * @param {number} warehouseLng - Warehouse longitude
 * @returns {Promise<Object>} Supply chain analysis
 */
export const checkSupplyChain = async (storeLat, storeLng, warehouseLat, warehouseLng) => {
  try {
    const response = await api.post('/supply-chain', {
      store_lat: storeLat,
      store_lng: storeLng,
      warehouse_lat: warehouseLat,
      warehouse_lng: warehouseLng,
    });
    return response.data;
  } catch (error) {
    console.error('Supply chain error:', error);
    throw error;
  }
};

/**
 * Health check
 * @returns {Promise<Object>} Health status
 */
export const healthCheck = async () => {
  try {
    const response = await api.get('/health');
    return response.data;
  } catch (error) {
    console.error('Health check failed:', error);
    throw error;
  }
};



export default api;
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  darkMode: 'class', // Enable class-based dark mode
  theme: {
    extend: {
      colors: {
        // Canvas - Background layers
        canvas: {
          deep: '#020617',  // slate-950
          base: '#0f172a',  // slate-900
        },
        // Light mode canvas
        'canvas-light': {
          deep: '#f8fafc',  // slate-50
          base: '#f1f5f9',  // slate-100
        },
        // Surface - Glass layers
        surface: {
          primary: 'rgba(15, 23, 42, 0.8)',
          secondary: 'rgba(30, 41, 59, 0.7)',
          elevated: 'rgba(51, 65, 85, 0.6)',
          border: 'rgba(255, 255, 255, 0.08)',
        },
        // Light mode surfaces
        'surface-light': {
          primary: 'rgba(255, 255, 255, 0.9)',
          secondary: 'rgba(248, 250, 252, 0.9)',
          elevated: 'rgba(241, 245, 249, 0.9)',
          border: 'rgba(0, 0, 0, 0.1)',
        },
        // Primary - Neon Emerald
        primary: {
          glow: '#10b981',     // emerald-500
          bright: '#34d399',   // emerald-400
          soft: 'rgba(16, 185, 129, 0.2)',
          pulse: 'rgba(16, 185, 129, 0.5)',
        },
        // Warning - Amber
        warning: {
          glow: '#f59e0b',     // amber-500
          soft: 'rgba(245, 158, 11, 0.2)',
        },
        // Destructive - Rose
        destructive: {
          glow: '#f43f5e',     // rose-500
          bright: '#fb7185',   // rose-400
          soft: 'rgba(244, 63, 94, 0.2)',
        },
        // Accent
        accent: {
          cyan: '#06b6d4',     // cyan-500
          violet: '#8b5cf6',   // violet-500
        }
      },
      fontFamily: {
        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
        mono: ['JetBrains Mono', 'Fira Code', 'Consolas', 'monospace'],
      },
      boxShadow: {
        'glow-primary': '0 0 20px rgba(16, 185, 129, 0.4), 0 0 40px rgba(16, 185, 129, 0.2)',
        'glow-warning': '0 0 20px rgba(245, 158, 11, 0.4), 0 0 40px rgba(245, 158, 11, 0.2)',
        'glow-destructive': '0 0 20px rgba(244, 63, 94, 0.4), 0 0 40px rgba(244, 63, 94, 0.2)',
        'glow-violet': '0 0 20px rgba(139, 92, 246, 0.4), 0 0 40px rgba(139, 92, 246, 0.2)',
        'glass': '0 8px 32px rgba(0, 0, 0, 0.4)',
      },
      backdropBlur: {
        'glass': '12px',
      },
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'slide-in-right': 'slideInRight 0.4s ease-out',
        'slide-in-up': 'slideInUp 0.3s ease-out',
        'fade-in': 'fadeIn 0.2s ease-out',
        'glow-pulse': 'glowPulse 2s ease-in-out infinite',
      },
      keyframes: {
        slideInRight: {
          '0%': { transform: 'translateX(20px)', opacity: '0' },
          '100%': { transform: 'translateX(0)', opacity: '1' },
        },
        slideInUp: {
          '0%': { transform: 'translateY(10px)', opacity: '0' },
          '100%': { transform: 'translateY(0)', opacity: '1' },
        },
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        glowPulse: {
          '0%, 100%': { boxShadow: '0 0 20px rgba(16, 185, 129, 0.4)' },
          '50%': { boxShadow: '0 0 30px rgba(16, 185, 129, 0.6), 0 0 60px rgba(16, 185, 129, 0.3)' },
        },
      },
    },
  },
  plugins: [],
}
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    host: true
  }
})
</file>

</files>
